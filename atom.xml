<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hale&#39;s Blog</title>
  <subtitle>stay hungry stay foolish</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://wuqiuhao.github.io/"/>
  <updated>2017-09-12T01:25:09.000Z</updated>
  <id>http://wuqiuhao.github.io/</id>
  
  <author>
    <name>Hale</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Concurrency Programing in Swift</title>
    <link href="http://wuqiuhao.github.io/2017/09/01/Concurrency%20Programing%20in%20Swift/"/>
    <id>http://wuqiuhao.github.io/2017/09/01/Concurrency Programing in Swift/</id>
    <published>2017-09-01T14:03:35.000Z</published>
    <updated>2017-09-12T01:25:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦è®¨è®ºå’Œä»‹ç»Swiftçš„å¹¶å‘ç¼–ç¨‹ï¼Œç°åœ¨iOSä¸­æœ‰ä¸¤å¥—æ¯”è¾ƒå…ˆè¿›çš„å¹¶å‘ç¼–ç¨‹æ–¹æ¡ˆå¯ä»¥ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œä¸€ä¸ªæ˜¯<code>GCD</code>ï¼Œå¦ä¸€ä¸ªæ˜¯<code>æ“ä½œé˜Ÿåˆ—ï¼ˆOperation Queuesï¼‰</code>ã€‚GCDæ˜¯ä¸€å¥—åŸºäºCçš„åº•å±‚APIï¼Œè€Œæ“ä½œé˜Ÿåˆ—æ˜¯åœ¨GCDåŸºç¡€ä¸Šçš„é¢ç›¸å¯¹è±¡æŠ½è±¡ï¼ŒGCDæä¾›äº†æ›´åŠ åº•å±‚çš„æ§åˆ¶ï¼Œè€Œæ“ä½œé˜Ÿåˆ—åˆ™åœ¨GCDä¹‹ä¸Šå®ç°äº†ä¸€äº›æ–¹ä¾¿çš„åŠŸèƒ½ã€‚</p>
<hr>
<h1 id="Operations-amp-Operation-Queues"><a href="#Operations-amp-Operation-Queues" class="headerlink" title="Operations &amp; Operation Queues"></a>Operations &amp; Operation Queues</h1><p><code>Operationsï¼ˆæ“ä½œï¼‰</code>ä»¥ä¸€ç§é¢å‘å¯¹è±¡çš„æ–¹å¼æ¥å°è£…éœ€è¦æ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡ï¼Œæ˜¯ä¸€å¥—è¾ƒä¸ºé«˜çº§çš„APIã€‚Operationsåœ¨Swiftä¸­ä¸»è¦æœ‰<code>Operation</code>å’Œ<code>BlockOperation</code>ä¸¤ä¸ªç±»ï¼Œä»–ä»¬å¯ä»¥å„è‡ªå•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥è¢«æ·»åŠ åˆ°<code>Operation Queueï¼ˆæ“ä½œé˜Ÿåˆ—ï¼‰</code>ä¸­æ‰§è¡Œä»»åŠ¡ã€‚</p>
<h2 id="Operations"><a href="#Operations" class="headerlink" title="Operations"></a>Operations</h2><h3 id="Operation"><a href="#Operation" class="headerlink" title="Operation"></a>Operation</h3><p>Operationæ˜¯æ“ä½œçš„ä¸€ä¸ªåŸºç±»ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¯ä»¥é€šè¿‡ç»§æ‰¿çš„æ–¹å¼æ¥å®ç°ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œç±»ï¼Œä¾‹å¦‚é€šè¿‡è‡ªå®šä¹‰æ“ä½œç±»æˆ‘ä»¬èƒ½å¤Ÿæ›´æ”¹æ“ä½œçš„æ‰§è¡Œæ–¹å¼æˆ–è€…æ‰“å°ä½œä¸šæ‰§è¡Œè¿‡ç¨‹ä¸­çš„çŠ¶æ€å˜åŒ–ã€‚å¦‚æœæˆ‘ä»¬ç›´æ¥ç»§æ‰¿Operationå®ç°çš„æ“ä½œç±»æ˜¯åŒæ­¥ï¼ˆSyncï¼‰æ‰§è¡Œçš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ‰‹åŠ¨ç®¡ç†stateæ¥å®ç°æ“ä½œç±»çš„å¼‚æ­¥ï¼ˆAsyncï¼‰æ‰§è¡Œã€‚ä¸‹é¢æˆ‘ä»¬å°†è‡ªå®šä¹‰å®ç°ä¸€ä¸ªAsyncOperationï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">class AsyncOperation: Operation &#123;</div><div class="line">  enum State: String &#123;</div><div class="line">    case Ready, Executing, Finished</div><div class="line">    </div><div class="line">    fileprivate var keyPath: String &#123;</div><div class="line">      return &quot;is&quot; + rawValue</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  var state = State.Ready &#123;</div><div class="line">    willSet &#123;</div><div class="line">      willChangeValue(forKey: newValue.keyPath)</div><div class="line">      willChangeValue(forKey: state.keyPath)</div><div class="line">    &#125;</div><div class="line">    didSet &#123;</div><div class="line">      didChangeValue(forKey: oldValue.keyPath)</div><div class="line">      didChangeValue(forKey: state.keyPath)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">extension AsyncOperation &#123;</div><div class="line">  // NSOperation Overrides</div><div class="line">  override var isReady: Bool &#123;</div><div class="line">    return super.isReady &amp;&amp; state == .Ready</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  override var isExecuting: Bool &#123;</div><div class="line">    return state == .Executing</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  override var isFinished: Bool &#123;</div><div class="line">    return state == .Finished</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  override var isAsynchronous: Bool &#123;</div><div class="line">    return true</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  override func start() &#123;</div><div class="line">    if isCancelled &#123;</div><div class="line">      state = .Finished</div><div class="line">      return</div><div class="line">    &#125;</div><div class="line">    main()</div><div class="line">    state = .Executing</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  override func cancel() &#123;</div><div class="line">    state = .Finished</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å®ç°äº†AsyncOperationä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤è°ƒç”¨ï¼š</p>
<blockquote>
<p>1.ç»§æ‰¿AsyncOperation<br>2.é‡å†™mainæ–¹æ³•ï¼Œåœ¨mainæ–¹æ³•ä¸­æ‰§è¡ŒAsyncæ“ä½œ<br>3.åœ¨Asyncçš„callbackæ–¹æ³•ä¸­å°†stateç½®ä¸º<code>.Finished</code></p>
</blockquote>
<p>è°ƒç”¨ç¤ºä¾‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class MyLoginOperation: AsyncOperation &#123;</div><div class="line">  override func main() &#123;</div><div class="line">    RequestAPI.login(params, callback: &#123;</div><div class="line">        self.state = .Finished</div><div class="line">        // TODO: login success</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">let op = MyLoginOperation()</div><div class="line">OperationQueue().addOperation(op)</div></pre></td></tr></table></figure></p>
<h3 id="BlockOperation"><a href="#BlockOperation" class="headerlink" title="BlockOperation"></a>BlockOperation</h3><p>BlockOperation,ç»§æ‰¿è‡ªOperationï¼Œå¯ä»¥å¹¶å‘çš„æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªblockï¼Œåªæœ‰å½“æ‰€æœ‰çš„blockéƒ½æ‰§è¡Œå®Œæ¯•ï¼Œæ•´ä¸ªæ“ä½œæ‰ç®—æ‰§è¡Œå®Œæ¯•ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">let blockOperation = BlockOperation &#123;</div><div class="line">    sleep(2)</div><div class="line">    print(&quot;ğŸ&quot;)</div><div class="line">&#125;</div><div class="line">blockOperation.addExecutionBlock &#123;</div><div class="line">    print(&quot;ğŸ&quot;)</div><div class="line">&#125;</div><div class="line">blockOperation.addExecutionBlock &#123;</div><div class="line">    print(&quot;ğŸ&quot;)</div><div class="line">&#125;</div><div class="line">blockOperation.addExecutionBlock &#123;</div><div class="line">    print(&quot;ğŸ‡&quot;)</div><div class="line">&#125;</div><div class="line">blockOperation.completionBlock = &#123;</div><div class="line">    print(&quot;all works cmplete!&quot;)</div><div class="line">&#125;</div><div class="line">blockOperation.start()</div></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹è¾“å‡ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ğŸ‡</div><div class="line">ğŸ</div><div class="line">ğŸ</div><div class="line">ğŸ</div><div class="line">all works cmplete!</div></pre></td></tr></table></figure></p>
<h2 id="Operation-Queues"><a href="#Operation-Queues" class="headerlink" title="Operation Queues"></a>Operation Queues</h2><p>ä¸Šé¢æˆ‘ä»¬æåˆ°äº†æˆ‘ä»¬å¯ä»¥è°ƒç”¨operationè‡ªèº«çš„startæ–¹æ³•å‡ºå‘ä½œä¸šæ‰§è¡Œï¼Œä½†æ˜¯åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€é‡‡ç”¨å°†operationæ·»åŠ åˆ°ä¸€ä¸ªæŒ‡å®šçš„queueä¸­æ¥æ‰§è¡Œä½œä¸šã€‚æ“ä½œé˜Ÿåˆ—æ˜¯<code>OperationQueue</code>çš„ä¸€ä¸ªå®ä¾‹ï¼Œä»»åŠ¡ä¸€æ—¦è¢«æ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—ä¸­ä¸ä¹…ä¾¿ä¼šè‡ªåŠ¨æ‰§è¡Œæ“ä½œï¼Œæ‰€ä»¥å¦‚æœéœ€è¦è®¾ç½®æ“ä½œæˆ–é˜Ÿåˆ—çš„ä¸€äº›å±æ€§ï¼Œéœ€è¦åœ¨å…¶è¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¹‹å‰è®¾ç½®ï¼Œåœ¨æ·»åŠ åˆ°é˜Ÿåˆ—ä¹‹åçš„è®¾ç½®å°†ä¸ä¼šç”Ÿæ•ˆã€‚æ“ä½œé˜Ÿåˆ—é»˜è®¤æ˜¯ä¸€ä¸ªå¹¶è¡Œé˜Ÿåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>maxConcurrentOperationCount</code>è¿™ä¸ªå±æ€§è®¾ç½®é˜Ÿåˆ—çš„å¹¶å‘æ•°ï¼Œå½“å¹¶å‘æ•°ä¸º1çš„æ—¶å€™ï¼Œæ“ä½œé˜Ÿåˆ—å°±æ˜¯ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ã€‚æ“ä½œé˜Ÿåˆ—é»˜è®¤æ˜¯ï¼ˆAsyncï¼‰å¼‚æ­¥æ‰§è¡Œçš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨<code>waitUntilAllOperationsAreFinished()</code>æ–¹æ³•æˆ–å°†<code>addOperations(_ ops: [Operation], waitUntilFinished wait: Bool)</code>æ–¹æ³•çš„<code>waitUntilFinished</code>å±æ€§è®¾ç½®ä¸ºtrue,ä½¿å…¶æˆä¸ºåŒæ­¥ï¼ˆSyncï¼‰åŒæ­¥é˜Ÿåˆ—ã€‚ä¸‹é¢é€šè¿‡ç¤ºä¾‹ä»£ç æ¥è¯¦ç»†è®²è§£æ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨ã€‚</p>
<p>1.é¦–å…ˆæˆ‘ä»¬åˆ›å»ºäº†4ä¸ªoperationå’Œä¸€ä¸ªæ“ä½œé˜Ÿåˆ—ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">let op1 = BlockOperation &#123;</div><div class="line">    sleep(2)</div><div class="line">    print(&quot;ğŸ&quot;)</div><div class="line">&#125;</div><div class="line">let op2 = BlockOperation &#123;</div><div class="line">    print(&quot;ğŸ&quot;)</div><div class="line">&#125;</div><div class="line">let op3 = BlockOperation &#123;</div><div class="line">    print(&quot;ğŸ&quot;)</div><div class="line">&#125;</div><div class="line">let op4 = BlockOperation &#123;</div><div class="line">    print(&quot;ğŸ‡&quot;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">let queue = OperationQueue()</div></pre></td></tr></table></figure></p>
<p>2.ç„¶åæˆ‘ä»¬è®¾ç½®äº†é˜Ÿåˆ—çš„å¹¶å‘æ•°ä¸º4ï¼Œå¹¶å°†4ä¸ªæ“ä½œå¯¹è±¡æ·»åŠ åˆ°äº†æ“ä½œé˜Ÿåˆ—ä¸­ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">queue.maxConcurrentOperationCount = 4</div><div class="line">queue.addOperations([op1,op2,op3,op4], waitUntilFinished: true)</div></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹è¾“å‡º1ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ğŸ</div><div class="line">ğŸ</div><div class="line">ğŸ‡</div><div class="line">ğŸ</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªç»“æœæˆ‘ä»¬å¹¶ä¸æ„Ÿåˆ°æ„å¤–ï¼Œç”±äºæ˜¯å¹¶å‘é˜Ÿåˆ—ï¼Œå¹¶ä¸”op1çš„ä½œä¸šä¸­å«æœ‰å»¶æ—¶æ“ä½œï¼Œæ‰€ä»¥å‰ä¸‰ä¸ªçš„è¾“å‡ºé¡ºåºå¹¶ä¸ä¸€å®šï¼Œä½†æ˜¯ç¬¬å››ä¸ªè¾“å‡ºçš„ä¸€å®šæ˜¯ğŸã€‚å¦‚æœæˆ‘ä»¬æŠŠä¸Šé¢ç¬¬2æ­¥çš„ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">queue.maxConcurrentOperationCount = 4</div><div class="line">queue.addOperations([op1,op2,op3,op4], waitUntilFinished: false)</div></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹è¾“å‡º2ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ğŸ</div><div class="line">ğŸ</div><div class="line">ğŸ‡</div></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶é˜Ÿåˆ—å¹¶å‘å¼‚æ­¥æ‰§è¡Œæ“ä½œï¼Œç”±äºop1çš„å»¶æ—¶å¤„ç†ï¼Œop1çš„æ‰§è¡Œå°†è¢«ç›´æ¥è¿”å›ï¼Œæ‰€ä»¥æœ€ç»ˆè¾“å‡ºç»“æœä¸­å¹¶æ²¡æœ‰op1çš„è¾“å‡ºã€‚å¦‚æœå°†ä¸Šé¢çš„ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">queue.maxConcurrentOperationCount = 1</div><div class="line">queue.addOperations([op1,op2,op3,op4], waitUntilFinished: true)</div></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹è¾“å‡º3ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ğŸ</div><div class="line">ğŸ</div><div class="line">ğŸ</div><div class="line">ğŸ‡</div></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶æ“ä½œé˜Ÿåˆ—æ˜¯ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼Œæ‰€ä»¥ç¨‹åºæ‰§è¡Œ2såä¾æ¬¡æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„æ“ä½œï¼ŒæŒ‰FIFOçš„é¡ºåºè¾“å‡ºäº†ç»“æœã€‚å¦‚æœæˆ‘ä»¬å°†ä¸Šé¢çš„ä»£ç ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">queue.maxConcurrentOperationCount = 1</div><div class="line">queue.addOperations([op1,op2,op3,op4], waitUntilFinished: false)</div></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹è¾“å‡º4ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"> </div></pre></td></tr></table></figure></p>
<p>æ˜¯çš„ï¼Œä»£ç æ‰§è¡Œåæ§åˆ¶å°å°†æ²¡æœ‰ä»»ä½•è¾“å‡ºã€‚ç”±äºæˆ‘ä»¬è®¾ç½®é˜Ÿåˆ—çš„å¹¶å‘æ•°ä¸º1ï¼Œæ‰€ä»¥å½“å‰åªæœ‰ä¸€ä¸ªçº¿ç¨‹ç”¨äºä»»åŠ¡è°ƒåº¦ï¼ŒåŒæ—¶æˆ‘ä»¬è®¾ç½®äº†<code>waitUntilFinished</code>ä¸ºfalseï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œçš„é˜Ÿåˆ—ï¼Œæ‰€ä»¥å½“æ‰§è¡Œop1å»¶æ—¶å‡½æ•°æ—¶ï¼Œå”¯ä¸€çš„çº¿ç¨‹ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥åç»­çš„æ“ä½œéƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚</p>
<h3 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h3><p>å¦‚æœåœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬æƒ³è¦æ“ä½œæŒ‰æˆ‘ä»¬æŒ‡å®šçš„é¡ºåºæ¥æ‰§è¡Œï¼Œoperationä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§ååˆ†ä¾¿æ·çš„æ–¹å¼ï¼Œoperationæ”¯æŒäº’ç›¸è®¾ç½®ä¾èµ–ï¼Œå¦‚op1ä¾èµ–äºop2ï¼Œop2ä¾èµ–äºop3ï¼Œé‚£ä¹ˆæ“ä½œçš„æ‰§è¡Œé¡ºç§€å°±ä¼šæ˜¯op3-&gt;op2-&gt;op1ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">let op1 = BlockOperation &#123;</div><div class="line">    print(&quot;ğŸ&quot;)</div><div class="line">&#125;</div><div class="line">let op2 = BlockOperation &#123;</div><div class="line">    print(&quot;ğŸ&quot;)</div><div class="line">&#125;</div><div class="line">let op3 = BlockOperation &#123;</div><div class="line">    print(&quot;ğŸ&quot;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">let queue = OperationQueue()</div><div class="line">queue.maxConcurrentOperationCount = 3</div><div class="line">op1.addDependency(op2)</div><div class="line">op2.addDependency(op3)</div><div class="line">queue.addOperations([op1,op2,op3], waitUntilFinished: false)</div></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹è¾“å‡ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ğŸ</div><div class="line">ğŸ</div><div class="line">ğŸ</div></pre></td></tr></table></figure></p>
<h3 id="Suspending-and-Resuming-Queues"><a href="#Suspending-and-Resuming-Queues" class="headerlink" title="Suspending and Resuming Queues"></a>Suspending and Resuming Queues</h3><p>å¦å¤–æ“ä½œé˜Ÿåˆ—å¯ä»¥éå¸¸æ–¹ä¾¿çš„è¿›è¡ŒæŒ‚èµ·å’Œæ¢å¤æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é˜Ÿåˆ—çš„<code>isSuspended</code>å±æ€§è®¾ç½®é˜Ÿåˆ—çš„æŒ‚èµ·å’Œæ¢å¤ï¼Œä½†æ˜¯é˜Ÿåˆ—çš„æŒ‚èµ·ï¼Œä¸ä¼šå½±å“å·²ç»è¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œåªæœ‰åç»­è¢«æ·»åŠ åˆ°é˜Ÿåˆ—çš„æ“ä½œä¼šæ”¶åˆ°å½±å“ã€‚æˆ‘ä»¬ç›´æ¥çœ‹ç¤ºä¾‹ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">let op1 = BlockOperation &#123;</div><div class="line">    print(&quot;ğŸ&quot;)</div><div class="line">&#125;</div><div class="line">let op2 = BlockOperation &#123;</div><div class="line">    print(&quot;ğŸ&quot;)</div><div class="line">&#125;</div><div class="line">let op3 = BlockOperation &#123;</div><div class="line">    print(&quot;ğŸ&quot;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">let queue = OperationQueue()</div><div class="line">queue.maxConcurrentOperationCount = 3</div><div class="line">queue.addOperations([op1,op2], waitUntilFinished: false)</div><div class="line"></div><div class="line">queue.isSuspended = true</div><div class="line">queue.addOperation(op3)</div></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹è¾“å‡ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ğŸ</div><div class="line">ğŸ</div></pre></td></tr></table></figure></p>
<h3 id="Practice"><a href="#Practice" class="headerlink" title="Practice"></a>Practice</h3><p>åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸å°†ä¸€äº›è€—æ—¶æ“ä½œæ”¾åˆ°å­çº¿ç¨‹ï¼Œå¾…æ“ä½œå®Œæˆåï¼Œæˆ‘ä»¬åˆ‡å›mainçº¿ç¨‹ï¼Œè¿›è¡Œä¸€äº›UIç›¸å…³çš„æ“ä½œã€‚å…¶å®è¿™ä¸€è¿‡ç¨‹å¯ä»¥ç”¨æ“ä½œé˜Ÿåˆ—å¾ˆæ–¹ä¾¿çš„å®ç°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">OperationQueue().addOperation &#123;</div><div class="line">            // TODO: some time consuming operations</div><div class="line">            OperationQueue.main.addOperation &#123;</div><div class="line">                // TODO: some UI operations</div><div class="line">            &#125;</div><div class="line">        &#125;</div></pre></td></tr></table></figure></p>
<h2 id="Operationså°ç»“"><a href="#Operationså°ç»“" class="headerlink" title="Operationså°ç»“"></a>Operationså°ç»“</h2><p>é€šè¿‡ä¸Šé¢çš„ä»‹ç»å’Œä½¿ç”¨ï¼Œæˆ‘ä»¬å‘ç°æ“ä½œé˜Ÿåˆ—è¿˜æ˜¯æ¯”è¾ƒçµæ´»å’Œæ–¹ä¾¿çš„ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ·»åŠ ä¾èµ–ã€‚è™½ç„¶å®ƒæ˜¯é«˜å±‚çº§çš„APIï¼Œç›¸å¯¹äºåº•å±‚APIæ¥è¯´å¯æ§åˆ¶çš„æƒé™ä¼šå°‘ä¸€äº›ï¼Œæ€§èƒ½ä¸Šå¯èƒ½ç¨æœ‰åå·®ï¼Œä½†åœ¨ä¸€å®šçš„åœºæ™¯ä¸‹ï¼Œè¿˜æ˜¯å¾ˆå€¼å¾—æ¨èçš„ã€‚</p>
<hr>
<h1 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h1><p>GCDæ˜¯Appleæä¾›çš„å¦ä¸€å¥—åŸºäºCçš„é«˜æ€§èƒ½åº•å±‚APIï¼Œåˆ©ç”¨å®ƒæˆ‘ä»¬å¯ä»¥è¿›è¡Œé«˜æ€§èƒ½çš„å¹¶å‘ç¼–ç¨‹ã€‚Swift3ä¹‹å‰å®ƒè¿˜ä¿æŒäº†Cè¯­è¨€çš„è°ƒç”¨åˆ†æ ¼ï¼ŒSwift3ä¹‹åAppleå¯¹å…¶è¿›è¡Œäº†é‡æ–°å°è£…ï¼Œæ–°çš„APIæ›´ç¬¦åˆé¢å‘å¯¹è±¡æ€ç»´ï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½ä¼šè¢«åŒ…è£…åˆ°ä¸€ä¸ªå‡½æ•°æˆ–è€…é—­åŒ…ä¸­ï¼Œå¯è¯»æ€§æ›´å¼ºï¼Œä¹Ÿæ›´ä¾¿äºä½¿ç”¨äº†ã€‚</p>
<h2 id="Dispatch-queues"><a href="#Dispatch-queues" class="headerlink" title="Dispatch queues"></a>Dispatch queues</h2><p><code>Dispatch queuesï¼ˆè°ƒåº¦é˜Ÿåˆ—ï¼‰</code>å¯ä»¥å¾ˆæ–¹ä¾¿çš„åˆ›å»ºå¹¶æ‰§è¡Œï¼ˆAsyncï¼‰å¼‚æ­¥å’Œï¼ˆSyncï¼‰åŒæ­¥ä»»åŠ¡ã€‚ä¾‹å¦‚ä½ å¯ä»¥å°†ä¸€äº›è€—æ—¶ä»»åŠ¡æ·»åŠ åˆ°ä¸€ä¸ªå‡½æ•°æˆ–è€…blockï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°è°ƒåº¦é˜Ÿåˆ—ä¸­æ‰§è¡Œã€‚GCDé»˜è®¤å®ç°äº†ä¸€äº›é˜Ÿåˆ—ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡GCDæä¾›çš„æ–¹æ³•åˆ›å»ºè‡ªå®šä¹‰é˜Ÿåˆ—ã€‚</p>
<h3 id="ä¸²è¡Œé˜Ÿåˆ—"><a href="#ä¸²è¡Œé˜Ÿåˆ—" class="headerlink" title="ä¸²è¡Œé˜Ÿåˆ—"></a>ä¸²è¡Œé˜Ÿåˆ—</h3><p>åœ¨GCDä¸­å¦‚ä¸è¿›è¡Œç‰¹æ®Šå¤„ç†é»˜è®¤åˆ›å»ºçš„éƒ½æ˜¯ä¸²è¡Œé˜Ÿåˆ—ã€‚ç”¨ä»£ç è¯´è¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let queue1 = DispatchQueue(label: &quot;SerialQueue1&quot;)</div></pre></td></tr></table></figure></p>
<p>å‘é˜Ÿåˆ—ä¸­æ·»åŠ ä½œä¸šå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ï¼ŒåŒæ—¶ä½ è¿˜å¯ä»¥æ§åˆ¶é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å°†ä»¥ï¼ˆAsyncï¼‰å¼‚æ­¥æˆ–ï¼ˆSyncï¼‰åŒæ­¥çš„æ–¹å¼æ‰§è¡Œã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">queue1.sync &#123;</div><div class="line">    print(&quot;ğŸŠ \(Thread.current)&quot;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">queue1.async &#123;</div><div class="line">    sleep(2)</div><div class="line">    print(&quot;ğŸ \(Thread.current)&quot;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">queue1.sync &#123;</div><div class="line">    print(&quot;ğŸ \(Thread.current)&quot;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹è¾“å‡ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ğŸŠ &lt;NSThread: 0x100a061e0&gt;&#123;number = 1, name = main&#125;</div><div class="line">ğŸ &lt;NSThread: 0x100a0b410&gt;&#123;number = 2, name = (null)&#125;</div><div class="line">ğŸ &lt;NSThread: 0x100a061e0&gt;&#123;number = 1, name = main&#125;</div></pre></td></tr></table></figure></p>
<p>è°ƒåº¦é˜Ÿåˆ—ä¸­çš„mainä¸»é˜Ÿåˆ—å°±æ˜¯ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼Œå®ƒåªèƒ½å­˜åœ¨äºä¸»çº¿ç¨‹ä¹‹ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å¤Ÿå¾€ä¸»é˜Ÿåˆ—ä¸­æ·»åŠ ï¼ˆSyncï¼‰åŒæ­¥æ“ä½œï¼Œå› ä¸ºåŒæ­¥æ“ä½œä¼šå µå¡ä¸»çº¿ç¨‹ã€‚</p>
<h3 id="å¹¶å‘é˜Ÿåˆ—"><a href="#å¹¶å‘é˜Ÿåˆ—" class="headerlink" title="å¹¶å‘é˜Ÿåˆ—"></a>å¹¶å‘é˜Ÿåˆ—</h3><p>ç³»ç»Ÿé»˜è®¤å®ç°äº†ä¸€ä¸ªå…¨å±€çš„å¹¶å‘é˜Ÿåˆ—ï¼Œå¦‚æœæ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šéœ€æ±‚ä¸€èˆ¬æˆ‘ä»¬ç›´æ¥å¯ä»¥æ‹¿æ¥ä½¿ç”¨,ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">DispatchQueue.global().async &#123;</div><div class="line">    // TODO: some time consuming operations</div><div class="line">    DispatchQueue.main.async &#123;</div><div class="line">        // TODO: some UI operations</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­å¸¸ç”¨çš„ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¸€èˆ¬å°†æ¯”è¾ƒè€—æ—¶çš„æ“ä½œæ”¾å…¥å…¨å±€å¹¶å‘é˜Ÿåˆ—ï¼Œå¾…è€—æ—¶ä»»åŠ¡å®Œæˆåˆ‡æ¢å›ä¸»é˜Ÿåˆ—è¿›è¡ŒUIç›¸å…³çš„æ“ä½œã€‚å¦‚æœæˆ‘ä»¬æœ‰ç‰¹æ®Šéœ€æ±‚ï¼ŒåŒæ ·å¯ä»¥è‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let queue = DispatchQueue(label: &quot;concurrencyQueue&quot;, attributes: .concurrent)</div></pre></td></tr></table></figure></p>
<h3 id="Dispatch-Group"><a href="#Dispatch-Group" class="headerlink" title="Dispatch Group"></a>Dispatch Group</h3><p>å¦‚æœåœ¨å®é™…å¼€å‘ä¸­æˆ‘ä»¬å¸Œæœ›å¤šä¸ªç½‘ç»œè¯·æ±‚éƒ½è¿”å›äº†åœ¨æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Dispatch Groupå¾ˆæ–¹ä¾¿çš„å®ç°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">let group = DispatchGroup()</div><div class="line">let queue = DispatchQueue(label: &quot;groupQueue&quot;)</div><div class="line"></div><div class="line">queue.async(group: group) &#123;</div><div class="line">    print(&quot;ğŸ&quot;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">queue.async(group: group) &#123;</div><div class="line">    print(&quot;ğŸ&quot;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">group.notify(queue: queue) &#123;</div><div class="line">    print(&quot;all tasks complete&quot;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹è¾“å‡ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ğŸ</div><div class="line">ğŸ</div><div class="line">all tasks complete</div></pre></td></tr></table></figure></p>
<h3 id="å»¶æ—¶æ“ä½œ"><a href="#å»¶æ—¶æ“ä½œ" class="headerlink" title="å»¶æ—¶æ“ä½œ"></a>å»¶æ—¶æ“ä½œ</h3><p>åœ¨å¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€äº›å»¶æ—¶æ“ä½œï¼ŒDispatch queueæä¾›äº†ä¸€å¥—éå¸¸ç®€å•çš„æ–¹æ³•ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">let queue = DispatchQueue(label: &quot;queuename&quot;)</div><div class="line">queue.asyncAfter(deadline: .now() + 2) &#123;</div><div class="line">    // TODO: some task</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="GCDå°ç»“"><a href="#GCDå°ç»“" class="headerlink" title="GCDå°ç»“"></a>GCDå°ç»“</h2><p>æœ¬æ–‡åˆ—ä¸¾äº†GCDåœ¨å¹¶å‘ç¼–ç¨‹ä¸­å¸¸è§çš„ä¸€äº›æ“ä½œï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†å…³äº<a href="https://developer.apple.com/library/content/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW1" target="_blank" rel="external">Dispatch Sources</a>çš„æ²¡æœ‰å±•å¼€ï¼Œå¸Œæœ›æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªè¡Œç ”ç©¶ã€‚</p>
<hr>
<h1 id="æ“ä½œé˜Ÿåˆ—ï¼ˆOperation-Queuesï¼‰è¿˜æ˜¯GCDï¼Ÿ"><a href="#æ“ä½œé˜Ÿåˆ—ï¼ˆOperation-Queuesï¼‰è¿˜æ˜¯GCDï¼Ÿ" class="headerlink" title="æ“ä½œé˜Ÿåˆ—ï¼ˆOperation Queuesï¼‰è¿˜æ˜¯GCDï¼Ÿ"></a>æ“ä½œé˜Ÿåˆ—ï¼ˆOperation Queuesï¼‰è¿˜æ˜¯GCDï¼Ÿ</h1><p>æˆ‘è®¤ä¸ºåœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œåœ¨ç›¸åŒçš„åœºæ™¯ä¸‹ï¼Œå¦‚æœå®ç°éš¾åº¦ç›¸å½“ï¼Œæˆ‘ä»¬é¦–é€‰GCDï¼Œæ¯•ç«Ÿå®ƒæ˜¯æ¯”è¾ƒåº•å±‚çš„å®ç°ï¼Œæ€§èƒ½ä¹Ÿä¼šå‡ºè‰²äº›ã€‚ä½†æ˜¯å¦‚æœæœ‰çš„åœºæ™¯æ“ä½œé˜Ÿåˆ—å®ç°èµ·æ¥æ–¹ä¾¿å¾—å¤šï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ç›´æ¥ä½¿ç”¨æ“ä½œé˜Ÿåˆ—å®ç°ã€‚å¦å¤–ï¼Œé€‰æ‹©æ“ä½œé˜Ÿåˆ—è¿˜æ˜¯GCDä¹Ÿå› äººè€Œå¼‚ï¼Œä¸ç®¡æ˜¯å“ªä¸€ç§åªè¦ä½¿ç”¨èµ·æ¥å¾—å¿ƒåº”æ‰‹ï¼Œéƒ½æ˜¯å¯ä»¥çš„ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ä¸»è¦è®¨è®ºå’Œä»‹ç»Swiftçš„å¹¶å‘ç¼–ç¨‹ï¼Œç°åœ¨iOSä¸­æœ‰ä¸¤å¥—æ¯”è¾ƒå…ˆè¿›çš„å¹¶å‘ç¼–ç¨‹æ–¹æ¡ˆå¯ä»¥ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œä¸€ä¸ªæ˜¯&lt;code&gt;GCD&lt;/code&gt;ï¼Œå¦ä¸€ä¸ªæ˜¯&lt;code&gt;æ“ä½œé˜Ÿåˆ—ï¼ˆOperation Queuesï¼‰&lt;/code&gt;ã€‚GCDæ˜¯ä¸€å¥—åŸºäºCçš„åº•å±‚APIï¼Œè€Œæ“ä½œé˜Ÿåˆ—æ˜¯åœ¨GCDåŸºç¡€ä¸Š
    
    </summary>
    
      <category term="iOS" scheme="http://wuqiuhao.github.io/categories/iOS/"/>
    
    
      <category term="Concurrency Operations GCD" scheme="http://wuqiuhao.github.io/tags/Concurrency-Operations-GCD/"/>
    
  </entry>
  
  <entry>
    <title>RxSwiftå“åº”å¼ç¼–ç¨‹å­¦ä¹ ä¸ç†è§£</title>
    <link href="http://wuqiuhao.github.io/2017/08/09/RxSwift%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E4%B8%8E%E7%90%86%E8%A7%A3/"/>
    <id>http://wuqiuhao.github.io/2017/08/09/RxSwiftå“åº”å¼ç¼–ç¨‹å­¦ä¹ ä¸ç†è§£/</id>
    <published>2017-08-09T14:03:35.000Z</published>
    <updated>2017-08-08T16:46:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å…¬å¸åœ¨å‰ç«¯æ¶æ„ä¼˜åŒ–æ–¹æ¡ˆæ—¶æåˆ°äº†MVPå’ŒMVVMä¸¤ç§æ¨¡å¼ï¼Œå…¶å®è¿™ä¸¤ç§æ¶æ„ä»æ¥è§¦ç§»åŠ¨ç«¯å¼€å‘ä»¥æ¥ï¼Œä¸€ç›´æœ‰å¬åˆ°è¿‡ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰æ·±å…¥çš„å»å­¦ä¹ ç†è§£ã€‚å€Ÿè¿™æ¬¡Appä»£ç é‡æ„çš„æœºä¼šï¼Œæˆ‘ä»”ç»†çš„äº†è§£äº†MVPå’ŒMVVMä¸¤ç§æ¶æ„ã€‚å…¶ä¸­åœ¨æ¥è§¦MVVMæ—¶ï¼Œæåˆ°äº†ä¸€ç§ç»‘å®šï¼ˆå“åº”å¼ï¼‰çš„æ¦‚å¿µï¼Œå³Modelå’ŒViewModelä¹‹é—´åŒå‘ç»‘å®šï¼ŒViewçš„å˜åŠ¨ï¼Œ<code>è‡ªåŠ¨</code>åæ˜ åœ¨ ViewModelï¼Œåä¹‹äº¦ç„¶ã€‚äºæ˜¯æˆ‘å°±æƒ³åˆ©ç”¨ä¸šä½™æ—¶é—´å¥½å¥½å­¦ä¹ ä¸€ä¸‹RxSwiftï¼Œç†è§£è¿™ç§å“åº”å¼çš„æ–¹å¼æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<h2 id="RxSwiftçš„æœ¬è´¨"><a href="#RxSwiftçš„æœ¬è´¨" class="headerlink" title="RxSwiftçš„æœ¬è´¨"></a>RxSwiftçš„æœ¬è´¨</h2><p>RxSwiftå®˜æ–¹æ–‡æ¡£ä¸­å†™åˆ°äº†æ‰€æœ‰<code>Observable</code>çš„å®ä¾‹éƒ½ç›¸å½“äºSwiftä¸­çš„<code>Sequence</code>ï¼Œå¹¶ä¸”å’Œ<code>Sequence</code>ç›¸æ¯”å®ƒè¿˜èƒ½å¼‚æ­¥çš„æ¥å—å‚æ•°;<code>ObservableType.subscribe(_:)</code>å°±ç›¸å½“äºSwiftä¸­çš„<code>Sequence.makeIterator()</code>,ä¸åŒçš„æ˜¯åœ¨RxSwiftä¸­ä¸éœ€è¦æ‰‹åŠ¨çš„è°ƒç”¨<code>next()</code>æ–¹æ³•ï¼Œ<code>Observable</code>å°±èƒ½è‡ªåŠ¨çš„å°†äº‹ä»¶å‘é€ç»™<code>Observer</code>ã€‚è¿™å°±æ˜¯RxSwiftçš„æœ¬è´¨ï¼Œä¸€åˆ‡éƒ½å»ºç«‹åœ¨è¿™ä¸ªåŸºç¡€ä¸Šã€‚</p>
<h2 id="Observableå’ŒObserver"><a href="#Observableå’ŒObserver" class="headerlink" title="Observableå’ŒObserver"></a>Observableå’ŒObserver</h2><p>è™½ç„¶å·²ç»å¾ˆæ¸…æ¥šçš„æ˜ç™½çš„RxSwiftçš„æœ¬è´¨æ‰€åœ¨ï¼Œä½†æ˜¯ä¸ææ¸…æ¥š<code>Observable</code>å’Œ<code>Observer</code>è¿™ä¸¤ä¸ªä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘å§‹ç»ˆå¯¹RxSwiftä¸€å›¢æ±¡æ°´ã€‚å…¶å®é€šè¿‡å­—é¢æ„æ€æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“<code>Observable</code>æ˜¯å¯ä»¥è¢«è§‚å¯Ÿçš„æ„æ€ï¼Œæ‰€ä»¥å®ƒæ˜¯<code>è¢«è§‚å¯Ÿè€…</code>ï¼Œé‚£ä¹ˆ<code>Observer</code>å°±æ˜¯<code>è§‚å¯Ÿè€…</code>ï¼Œåœ¨RxSwiftä¸­<code>Observer</code>å®ç°äº†<code>ObserverType</code>,è¿™æ˜¯ä¸€ä¸ª<code>protocol</code>ã€‚<code>ObserverType</code>çº¦å®šäº†ä¸€ä¸ªæ–¹æ³•<code>on(_ event: Event&lt;E&gt;)</code>ç”¨äºå°è£…è¢«è®¢é˜…è€…å‘é€çš„äº‹ä»¶å›è°ƒã€‚äº‹ä»¶å›è°ƒåˆ†ä¸º<code>next</code>ã€<code>error</code>å’Œ<code>completed</code>ä¸‰ç§ã€‚åŒç†ï¼Œ<code>Observable</code>ä¹Ÿå®ç°äº†ä¸€ä¸ªåè®®<code>ObservableType</code>ï¼Œ<code>ObservableType</code>ä¸»è¦çº¦å®šçš„æ–¹æ³•ä¸º<code>subscribe&lt;O: ObserverType&gt;(_ observer: O)</code>,<code>subscribe</code>æ–¹æ³•å¼€æ”¾äº†è‡ªèº«è¢«è®¢é˜…çš„å…¥å£ï¼Œè§‚å¯Ÿè€…å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•è®¢é˜…è¢«è§‚å¯Ÿå¯¹è±¡ã€‚</p>
<h2 id="Letâ€˜s-Try"><a href="#Letâ€˜s-Try" class="headerlink" title="Letâ€˜s Try"></a>Letâ€˜s Try</h2><p>è¿™é‡Œæˆ‘çœç•¥äº†RxSwiftçš„ä¸€äº›è¯­æ³•æ•™ç¨‹ï¼Œå› ä¸ºæœ¬æ–‡ä¸»è¦æ˜¯æƒ³è¦å’Œå¤§å®¶åˆ†äº«æˆ‘å¯¹RxSwiftå“åº”å¼å®ç°çš„ç†è§£ã€‚å¦‚æœæœ‰ä¸ç†è§£çš„åœ°æ–¹å¯ä»¥ç›´æ¥åˆ°githubä¸Šä¸‹è½½<a href="https://github.com/ReactiveX/RxSwift" target="_blank" rel="external">RxSwift-master</a>,é‡Œé¢çš„<code>Rx.playground</code>æ˜¯å¾ˆå¥½çš„ä¸€ä»½RxSwiftè¯­æ³•æ•™ç¨‹ã€‚è¿›å…¥æ­£é¢˜ï¼Œä»¥ä¸‹æ˜¯ä¸€æ®µæˆ‘ç”¨RxSwiftå†™çš„ä¼ªä»£ç ï¼Œæ¨¡æ‹Ÿäº†ç”¨æˆ·å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå¹¶å°†ç½‘ç»œè¯·æ±‚çš„ç»“æœå¼‚æ­¥è¿”å›ç»™è§‚å¯Ÿè€…ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">let observable = Observable.create(&#123; (observer) -&gt; Disposable in</div><div class="line">       let request = MyRequestAPI.get(url, ( (result, error) -&gt; &#123;</div><div class="line">           if let err = error &#123;</div><div class="line">               observer.onError(err)</div><div class="line">           &#125;</div><div class="line">           else if let response = result &#123;</div><div class="line">               observer.onNext(response)</div><div class="line">               observer.onComplete()</div><div class="line">           &#125;</div><div class="line">       &#125;)</div><div class="line">       return AnonymousDisposable &#123;</div><div class="line">           request.cancel()</div><div class="line">       &#125;</div><div class="line">   &#125;)</div><div class="line">   </div><div class="line">observable.subscribe(onNext: &#123; (response) in</div><div class="line">       // receive data do some thing</div><div class="line">   &#125;, onError: &#123; (err) in</div><div class="line">       // error do some thing</div><div class="line">   &#125;, onCompleted: &#123;</div><div class="line">       // complete request do some thing</div><div class="line">   &#125;, onDisposed: &#123;</div><div class="line">       // deinit</div><div class="line">   &#125;)</div></pre></td></tr></table></figure></p>
<p>åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘é€šè¿‡<code>create</code>æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª<code>observable</code>å®ä¾‹ï¼Œå°†MyRequestAPIçš„è¿”å›èŒèƒ½ç§»äº¤ç»™äº†ä¸€ä¸ª<code>observer</code>å¯¹è±¡ï¼Œå½“ç½‘ç»œè¯·æ±‚å¼‚å¸¸æ—¶ï¼Œæˆ‘ä¼šè°ƒç”¨<code>observer.onError()</code>ï¼Œè¿™æ„å‘³ç€ï¼Œåªè¦ç›‘å¬äº†è¿™ä¸ª<code>observable</code>å¯¹è±¡ï¼Œå°±ä¼šæ¥æ”¶åˆ°é”™è¯¯çš„æ¶ˆæ¯ã€‚äº‹å®ä¸Šåœ¨ç¬¬äºŒæ®µä»£ç ä¸­æˆ‘æ­£æ˜¯è¿™ä¹ˆåšçš„ï¼Œé€šè¿‡å¯¹<code>observable</code>çš„<code>subscribe</code>ï¼Œåˆ†åˆ«å¯¹ç½‘ç»œè¯·æ±‚çš„æˆåŠŸè¿”å›ã€å¼‚å¸¸ã€ç»“æŸã€é‡Šæ”¾ç­‰çŠ¶æ€è¿›è¡Œäº†ç›‘å¬ã€‚ä»è€Œèƒ½å¤Ÿåœ¨ç›¸åº”çš„äº‹ä»¶åˆ°æ¥ä¹‹é™…ï¼Œè¿›è¡Œç›¸åº”çš„æ“ä½œã€‚</p>
<h2 id="æœ€åˆçš„ç–‘é—®"><a href="#æœ€åˆçš„ç–‘é—®" class="headerlink" title="æœ€åˆçš„ç–‘é—®"></a>æœ€åˆçš„ç–‘é—®</h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»å¯¹RxSwiftçš„æ€ç»´æœ‰æ‰€äº†è§£ã€‚ä½†å¿ƒä¸­å¯èƒ½è¿˜æ˜¯æœ‰ä¸€ä¸ªç–‘é—®ï¼ŒRxSwiftæ˜¯å¦‚ä½•å®ç°å“åº”å¼è¿™ç§æ–¹å¼çš„ï¼Ÿé€šè¿‡é˜…è¯»<code>Observable.create</code>çš„æºç ï¼Œæˆ‘ä»ä¸­æ‰¾åˆ°äº†ç­”æ¡ˆã€‚åœ¨Rxå†…éƒ¨æœ‰ä¸€ä¸ªé›†åˆObserversï¼Œåœ¨æˆ‘ä»¬æ‰§è¡Œç›‘å¬æ–¹æ³•<code>subscribe</code>çš„æ—¶å€™ï¼Œä»¥ä¸Šé¢ä»£ç çš„<code>onNext</code>ä¸ºä¾‹ï¼Œæ­¤æ—¶åœ¨å…¶å†…éƒ¨ä¼šæ‰§è¡Œ<code>_observers.insert(observer.on)</code>è¿™æ ·ä¸€æ®µä»£ç ï¼Œå°±æ˜¯å°†è¿™ç§çŠ¶æ€çš„ç›‘å¬åŠ å…¥åˆ°é›†åˆä¸­ï¼Œå¾…æˆ‘ä»¬è°ƒç”¨<code>observer.onNext(response)</code>æ–¹æ³•çš„æ—¶å€™ï¼Œå®ƒä¼šå»éå†<code>_observers</code>ï¼Œå¦‚æœé›†åˆä¸­å­˜åœ¨ç›¸åŒçš„çŠ¶æ€ç±»å‹ï¼Œåˆ™æ‰§è¡Œå¯¹åº”çŠ¶æ€çš„<code>eventHander</code>é—­åŒ…ã€‚</p>
<h2 id="å†°å±±ä¸€è§’"><a href="#å†°å±±ä¸€è§’" class="headerlink" title="å†°å±±ä¸€è§’"></a>å†°å±±ä¸€è§’</h2><p>å¦‚æœè¦ä½¿ç”¨RxSwiftå®ç°ä¸€ä¸ªMVVMæ¶æ„çš„åº”ç”¨ï¼Œé‚£ä¸Šé¢æåˆ°çš„åº”ç”¨çŸ¥è¯†åªæ˜¯å†°å±±ä¸€è§’ï¼Œæ¯•ç«ŸRxSwiftæ˜¯ä¸€ä¸ªå¾ˆåºå¤§çš„é¡¹ç›®ï¼Œä»–è¿˜æœ‰ä¸€ä¸ªåå­—ç±»ä¼¼çš„ä»“åº“å«RxCocoaï¼ŒåŸºæœ¬ä¸Šæ¥è¯´ï¼ŒRxCocoaç»™æ‰€æœ‰çš„ Cocoa ç±»å»ºç«‹äº†æ‰©å±•æ–¹æ³•ï¼Œä»è€Œå¯ä»¥è®©UIè§†å›¾å»ºç«‹è¯¸å¦‚<code>rx.text</code>ä¹‹ç±»çš„ä¸œè¥¿ã€‚è¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦åƒä¸Šé¢ä¸€æ ·æ‰‹åŠ¨åˆ›å»ºObservableå¯¹è±¡ï¼Œå¯ä»¥å°‘å†™ä¸€ç‚¹subscribeNextæ–¹æ³•ï¼Œä»è€Œåœ¨å¤šä¸ªä¸åŒçš„è§†å›¾ç‚¹ä¸­å°†å€¼å’Œè§‚å¯Ÿå€¼ä¹‹é—´å»ºç«‹å…³è”ã€‚ç±»ä¼¼ä¸‹é¢çš„ä»£ç è¿™æ ·ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">let textField = UITextField()</div><div class="line">let delegate = TextFieldDelegate()</div><div class="line">textField.delegate = delegate</div><div class="line">var rxDidChange = false</div><div class="line">		</div><div class="line">_ = textField.rx.text</div><div class="line">	.skip(1) // Initial value</div><div class="line">	.subscribe(onNext: &#123; _ in</div><div class="line">	rxDidChange = true</div><div class="line">	&#125;, onCompleted: &#123;</div><div class="line">	completed = true</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»¥ä¸Šæ˜¯æˆ‘å¯¹RxSwiftä¸»è¦æ€æƒ³çš„ç†è§£ï¼Œæ—¨åœ¨å¸®åŠ©æƒ³è¦å…¥å‘RxSwiftçš„æœ‹å‹æ›´å¥½åœ°å…¥é—¨ã€‚æ¯•ç«ŸRxSwiftæ˜¯ä¸€ä¸ªæ¯”è¾ƒåºå¤§çš„ä½“ç³»ï¼Œé€šè¿‡è¿™æ¬¡å­¦ä¹ è¿˜æœ‰å¾ˆå¤šRxSwiftçš„çŸ¥è¯†å’Œè¯­æ³•æ²¡æœ‰äº†è§£ï¼Œæˆ‘ä¹Ÿä¼šåœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œç»§ç»­å­¦ä¹ ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘å…¬å¸åœ¨å‰ç«¯æ¶æ„ä¼˜åŒ–æ–¹æ¡ˆæ—¶æåˆ°äº†MVPå’ŒMVVMä¸¤ç§æ¨¡å¼ï¼Œå…¶å®è¿™ä¸¤ç§æ¶æ„ä»æ¥è§¦ç§»åŠ¨ç«¯å¼€å‘ä»¥æ¥ï¼Œä¸€ç›´æœ‰å¬åˆ°è¿‡ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰æ·±å…¥çš„å»å­¦ä¹ ç†è§£ã€‚å€Ÿè¿™æ¬¡Appä»£ç é‡æ„çš„æœºä¼šï¼Œæˆ‘ä»”ç»†çš„äº†è§£äº†MVPå’ŒMVVMä¸¤ç§æ¶æ„ã€‚å…¶ä¸­åœ¨æ¥è§¦MVVMæ—¶ï¼Œæåˆ°äº†ä¸€ç§ç»‘å®šï¼ˆå“åº”å¼ï¼‰çš„æ¦‚å¿µï¼Œå³Model
    
    </summary>
    
      <category term="iOS" scheme="http://wuqiuhao.github.io/categories/iOS/"/>
    
    
      <category term="RxSwift" scheme="http://wuqiuhao.github.io/tags/RxSwift/"/>
    
  </entry>
  
  <entry>
    <title>WCDBå­¦ä¹ ä¸ç†è§£</title>
    <link href="http://wuqiuhao.github.io/2017/07/17/WCDB%E5%AD%A6%E4%B9%A0%E4%B8%8E%E7%90%86%E8%A7%A3/"/>
    <id>http://wuqiuhao.github.io/2017/07/17/WCDBå­¦ä¹ ä¸ç†è§£/</id>
    <published>2017-07-17T02:47:08.000Z</published>
    <updated>2017-09-12T01:37:59.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>WCDBï¼ˆWeChat DataBaseï¼‰æ˜¯å¾®ä¿¡å®˜æ–¹çš„ç§»åŠ¨ç«¯æ•°æ®åº“ç»„ä»¶ï¼Œå®ƒåŸºäºSQLCipherï¼Œæ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼Œæ”¯æŒiOS, macOSå’ŒAndroidã€‚WCDBæä¾›äº†ä¸‰ä¸ªåŸºç¡€ç±»è¿›è¡Œæ•°æ®åº“æ“ä½œï¼šWCTDatabaseã€WCTTableã€WCTTransactionã€‚å®ƒä»¬çš„æ¥å£éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚WCDBå‡ ä¹æ¶µç›–äº†å¸¸ç”¨çš„æ•°æ®åº“æ“ä½œï¼ŒåŒæ—¶è¿˜å¼€æ”¾äº†æ ¸å¿ƒå±‚æ¥å£ï¼Œæ–¹ä¾¿ç”¨æˆ·æ‰©å±•ä¸€äº›æœªå°è£…çš„å¤æ‚SQLæ“ä½œã€‚å®‰å…¨æ–¹é¢å®ƒç»§æ‰¿äº†SQLCipherçš„åŠ å¯†æ–¹å¼ï¼Œå†…å»ºäº†Repair Kitç”¨äºä¿®å¤æŸåçš„æ•°æ®åº“,é€šè¿‡å†…å»ºå®çš„æ–¹å¼å®ç°äº†<code>ORMï¼ˆObject Relational Mapping)</code>ï¼Œæ–¹ä¾¿åœ°å®ç°äº†å¯¹è±¡å±æ€§åˆ°æ•°æ®è¡¨å­—æ®µçš„æ˜ å°„,é€šè¿‡ä¸€ç§åä¸º<code>WINQ</code>çš„è§„åˆ™å¯¹SQLè¿›è¡Œäº†æŠ½è±¡ï¼Œé¿å…äº†å†—é•¿çš„SQLèƒ¶æ°´ä»£ç ï¼Œä¹Ÿé˜²æ­¢äº†SQLæ³¨å…¥ã€‚</p>
<h2 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h2><p>WCDBä½¿ç”¨å†…ç½®çš„å®æ¥è¿æ¥ç±»ã€å±æ€§ä¸è¡¨ã€å­—æ®µã€‚å…±æœ‰ä¸‰ç±»å®ï¼Œåˆ†åˆ«å¯¹åº”æ•°æ®åº“çš„å­—æ®µã€ç´¢å¼•å’Œçº¦æŸã€‚æ‰€æœ‰å®éƒ½å®šä¹‰åœ¨WCTCodingMacro.hä¸­ã€‚WCDBçš„ORMä¼šè‡ªåŠ¨è¯†åˆ«propertyçš„ç±»å‹ï¼Œå¹¶æ˜ å°„åˆ°é€‚åˆçš„æ•°æ®åº“ç±»å‹ã€‚å…¶ä¸Objective-Cç±»å‹å¯¹åº”å…³ç³»ä¸ºï¼š</p>
<ul>
<li>æ•´å‹<ul>
<li>NSDateï¼ˆä¿å­˜å…¶æ—¶é—´æˆ³ï¼‰</li>
</ul>
</li>
<li>æµ®ç‚¹æ•°<ul>
<li>NSNumber</li>
</ul>
</li>
<li>å­—ç¬¦ä¸²<ul>
<li>NSStringã€NSMutableString</li>
</ul>
</li>
<li>äºŒè¿›åˆ¶<ul>
<li>NSDataã€NSMutableData</li>
<li>NSArrayã€NSMutableArray</li>
<li>NSDictionaryã€NSMutableDictionary</li>
<li>NSSetã€NSMutableSet</li>
<li>NSValue</li>
<li>NSURL</li>
</ul>
</li>
</ul>
<p>å…³äºORMå®˜æ–¹githubæ–‡æ¡£ç»™å‡ºäº†è¯¦ç»†çš„ä¸­è‹±æ–‡æ•™ç¨‹åŒ…æ‹¬å­—æ®µå®ã€ç´¢å¼•å®ã€çº¦æŸå®ç­‰åœ¨æ­¤ä¸ä¸€ä¸€åˆ—ä¸¾ã€‚</p>
<h2 id="WINQ"><a href="#WINQ" class="headerlink" title="WINQ"></a>WINQ</h2><p>WINQé¿å…äº†å†—é•¿å¤æ‚çš„SQLæ‹¼æ¥æ“ä½œï¼Œå¯¹SQLè¯­å¥è¿›è¡Œäº†æŠ½è±¡ã€‚æŠ½è±¡çš„æ€è·¯è¿˜æ˜¯ä»SQLè¯­æ³•è§„åˆ™å‡ºå‘ï¼ŒSQLçš„è¯­æ³•è§„åˆ™å®åˆ™ä¸Šæ˜¯ä¸€ç§é“¾å¼æ“ä½œï¼Œå¯ä»¥ç†è§£ä¸ºä¸€äº›å›ºå®šçš„keywordã€objectå’Œexprçš„é›†åˆã€‚æ‰€ä»¥WINQçš„å®ç°æ€è·¯æ˜¯å°†å›ºå®šçš„keywordï¼Œå°è£…ä¸ºå‡½æ•°åï¼Œä½œä¸ºè¿æ¥ï¼›å°†å¯ä»¥å±•å¼€çš„tokenï¼Œå°è£…ä¸ºç±»ï¼Œå¹¶åœ¨ç±»å†…å®ç°å…¶ä¸åŒçš„ç»„åˆã€‚è¿™å¥è¯å¯èƒ½è¯´çš„æœ‰ç‚¹ç»•ï¼Œé€šè¿‡ä¸‹é¢çš„ä»£ç å—å¯èƒ½æ¯”è¾ƒå¥½ç†è§£äº›ã€‚åœ¨ä¸‹é¢çš„ä»£ç å—ä¸­ï¼ŒæŠŠ<code>SELECT</code>å®šä¹‰æˆäº†ä¸€ä¸ªç±»<code>StatementSelect</code>,è¿™ä¸ªç±»æœ‰ä¸‰ä¸ªå‡½æ•°ï¼Œå‡½æ•°åæˆ‘ä»¬å¹¶ä¸é™Œç”Ÿï¼Œæ­£æ˜¯<code>where</code>ã€<code>limit</code>ã€<code>having</code>ä¸‰ä¸ªSQLå…³é”®å­—ï¼ŒåŒæ—¶å‡½æ•°çš„è¿”å›ä¹Ÿæ˜¯ä¸€ä¸ªStatementSelectå¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å®ç°ä¸€ç§é“¾å¼æ“ä½œã€‚å®ç°äº†ä¸Šé¢æåˆ°çš„<code>è¿æ¥</code>ã€‚å¦å¤–æˆ‘ä»¬å¯ä»¥å‘ç°ä¸‰ä¸ªå‡½æ•°è¿˜æœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼Œå®ƒä»¬çš„å‚æ•°éƒ½æ˜¯Exprç±»å‹ï¼Œå› ä¸ºåœ¨å®é™…çš„SQLè¯­æ³•è§„åˆ™ä¸­whereã€limitã€havingç­‰æ“ä½œéƒ½æ˜¯æ¥å—è¡¨è¾¾å¼çš„ï¼Œæ‰€ä»¥è¿™é‡ŒStatementSelectçš„ç±»æ–¹æ³•éƒ½æ˜¯è¡¨è¾¾å¼ã€‚ç„¶ååœ¨Exprå†…éƒ¨å¯ä»¥å®ç°è¡¨è¾¾å¼çš„å„ç§ç»„åˆã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">class StatementSelect : public Statement &#123;</div><div class="line">public:</div><div class="line">    //...</div><div class="line">    StatementSelect &amp;where(const Expr &amp;where);</div><div class="line">    StatementSelect &amp;limit(const Expr &amp;limit);</div><div class="line">    StatementSelect &amp;having(const Expr &amp;having);</div><div class="line">    //...</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">class Expr : public Describable &#123;</div><div class="line">public:</div><div class="line">    Expr(const Column &amp;column);</div><div class="line">    template &lt;typename T&gt;</div><div class="line">    Expr(const T &amp;value,</div><div class="line">         typename std::enable_if&lt;std::is_arithmetic&lt;T&gt;::value ||</div><div class="line">                                 std::is_enum&lt;T&gt;::value&gt;::type * = nullptr)</div><div class="line">        : Describable(literalValue(value))</div><div class="line">    &#123;</div><div class="line">    &#125;</div><div class="line">    Expr(const std::string &amp;value);</div><div class="line"></div><div class="line">    Expr operator||(const Expr &amp;operand) const;</div><div class="line">    Expr operator&amp;&amp;(const Expr &amp;operand) const;</div><div class="line">    Expr operator!=(const Expr &amp;operand) const;</div><div class="line"></div><div class="line">    Expr between(const Expr &amp;left, const Expr &amp;right) const;</div><div class="line">    Expr notBetween(const Expr &amp;left, const Expr &amp;right) const;</div><div class="line"></div><div class="line">    Expr isNull() const;</div><div class="line">    Expr isNotNull() const;</div><div class="line">    </div><div class="line">    //...</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>åŸºäºè¿™ä¸ªæŠ½è±¡æ–¹å¼ï¼Œå°±å¯ä»¥å¯¹å¤æ‚æŸ¥è¯¢ä¸­çš„æ¡ä»¶è¯­å¥è¿›è¡Œé‡å†™ä¸ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Column content(&quot;content&quot;);</div><div class="line">Column createTime(&quot;createTime&quot;);</div><div class="line">Column modifiedTime(&quot;modifiedTime&quot;);</div><div class="line">Column type(&quot;type&quot;);</div><div class="line">StatementSelect select;</div><div class="line">//...</div><div class="line">//WHERE content IS NOT NULL </div><div class="line">//      AND createTime!=modifiedTime </div><div class="line">//      OR type NOT BETWEEN 0 AND 2</div><div class="line">select.where(Expr(content).isNotNull()</div><div class="line">            &amp;&amp;Expr(createTime)!=Expr(modifiedTime)</div><div class="line">            ||Expr(type).notBetween(0, 2));</div><div class="line">//...</div></pre></td></tr></table></figure></p>
<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><h3 id="å»ºåº“"><a href="#å»ºåº“" class="headerlink" title="å»ºåº“"></a>å»ºåº“</h3><p>WCTDatabaseè¡¨ç¤ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¯ä»¥è¿›è¡Œæ‰€æœ‰æ•°æ®åº“æ“ä½œï¼ŒåŒ…æ‹¬å¢åˆ æŸ¥æ”¹ã€è¡¨æ“ä½œã€äº‹åŠ¡ã€æ–‡ä»¶æ“ä½œã€æŸåä¿®å¤ç­‰ã€‚å¯¹äºåŒä¸€ä¸ªè·¯å¾„çš„æ•°æ®åº“ï¼Œä¸åŒçš„WCTDatabaseã€WCTTableã€WCTTransactionå¯¹è±¡å…±äº«åŒä¸€ä¸ªWCDBæ ¸å¿ƒã€‚å› æ­¤ï¼Œä½ å¯ä»¥åœ¨ä»£ç çš„ä¸åŒä½ç½®ã€ä¸åŒçº¿ç¨‹ä»»æ„åˆ›å»ºä¸åŒçš„åŸºç¡€ç±»å¯¹è±¡ï¼ŒWCDBä¼šè‡ªåŠ¨ç®¡ç†å®ƒä»¬çš„å…±äº«æ•°æ®å’Œçº¿ç¨‹å¹¶å‘ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">NSString *path = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,</div><div class="line"> NSUserDomainMask, YES).firstObject stringByAppendingPathComponent:@&quot;test.db&quot;];</div><div class="line">_database = [[WCTDatabase alloc] initWithPath: path];</div><div class="line">[_database close:^&#123;</div><div class="line">	[_database removeFilesWithError:nil];</div><div class="line">&#125;];</div></pre></td></tr></table></figure></p>
<h3 id="å»ºè¡¨"><a href="#å»ºè¡¨" class="headerlink" title="å»ºè¡¨"></a>å»ºè¡¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">if (![_database isTableExists:@&quot;student&quot;]) &#123;</div><div class="line">	[_database createTableAndIndexesOfName:@&quot;student&quot; withClass:Student.class];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="æ•°æ®æ“ä½œ"><a href="#æ•°æ®æ“ä½œ" class="headerlink" title="æ•°æ®æ“ä½œ"></a>æ•°æ®æ“ä½œ</h3><h4 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Student *student = [[Student alloc] init];</div><div class="line">student.studentID = studentID;</div><div class="line">student.name = name;</div><div class="line">[_database insertObject:student into:@&quot;student&quot;];</div></pre></td></tr></table></figure>
<h4 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">return [_database getOneObjectOfClass:Student.class </div><div class="line">fromTable:@&quot;student&quot; where:Student.studentID == studentID];</div></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»¥ä¸Šæ˜¯æˆ‘é€šè¯»äº†WCDBçš„iOSå®˜æ–¹æ–‡æ¡£å’ŒAPIåšçš„ä¸€äº›æ€»ç»“ï¼Œå…¶ä¸­æœ‰ä¸€äº›è‡ªå·±çš„ç†è§£ï¼ŒåŒæ—¶ä¹Ÿæ¦‚æ‹¬äº†WCDBçš„æ ¸å¿ƒç†å¿µå’Œä½¿ç”¨æ–¹æ³•ã€‚å¦å¤–è¿˜æœ‰ä¸€äº›å…³äºæ•°æ®åº“ä¿®å¤ã€äº‹åŠ¡ã€çº¦æŸçš„æ“ä½œï¼Œæ²¡æœ‰è¯¦ç»†åˆ—ä¸¾ã€‚å¯ä»¥ç›´æ¥è®¿é—®å…¶githubé‡Œé¢çš„ä¸­è‹±æ–‡æ•™ç¨‹è®²çš„éå¸¸è¯¦ç»†ã€‚å¦å¤–æˆªæ­¢åˆ°2016å¹´12æœˆå¾®ä¿¡å…¨çƒå…±è®¡8.89äº¿æœˆæ´»ç”¨æˆ·ï¼Œè€Œæ–°å…´çš„å…¬ä¼—å·å¹³å°æ‹¥æœ‰1000ä¸‡ä¸ªï¼ŒWCDBä½œä¸ºæ”¯æ’‘è¿™ä¹ˆä¸€ä¸ªå¹³å°çš„ç§»åŠ¨ç«¯æ•°æ®åº“ï¼Œå…¶å®‰å…¨æ€§å’Œç¨³å®šæ€§åº”è¯¥è¿˜æ˜¯å€¼å¾—ä¿¡èµ–çš„ã€‚å¦‚æœæ˜¯çº¯OCçš„é¡¹ç›®ï¼Œå¦‚æœè§‰å¾—CoreDataå­¦ä¹ æˆæœ¬é«˜ï¼Œä¸å®¹æ˜“æŒæ¡ï¼Œä¸æ˜¯å¾ˆç¨³å®šçš„è¯ï¼Œæ¨èå¯ä»¥ä½¿ç”¨WCDBï¼Œä½†æ˜¯é¡¹ç›®ä¸­æ‰€æœ‰ç”¨åˆ°WCDBä¾èµ–çš„ç±»å®ç°æ–‡ä»¶éƒ½å¿…é¡»æ”¹æˆ<code>.mm</code>çš„å½¢å¼ã€‚ä½†å¦‚æœæ˜¯Swiftæˆ–è€…OC/Swiftæ··ç¼–é¡¹ç›®ï¼ŒWCDBç›®å‰å¯¹Swiftè¿˜ä¸æ˜¯å¾ˆå‹å¥½ï¼Œå¸Œæœ›WCDBå›¢é˜Ÿåç»­èƒ½å¯¹Swiftè¿›è¡Œæ”¯æŒå§ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h2&gt;&lt;p&gt;WCDBï¼ˆWeChat DataBaseï¼‰æ˜¯å¾®ä¿¡å®˜æ–¹çš„ç§»åŠ¨ç«¯æ•°æ®åº“ç»„ä»¶ï¼Œå®ƒåŸºäºSQLCipherï¼Œæ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼Œæ”¯æŒiOS, macO
    
    </summary>
    
      <category term="iOS" scheme="http://wuqiuhao.github.io/categories/iOS/"/>
    
    
      <category term="Database" scheme="http://wuqiuhao.github.io/tags/Database/"/>
    
  </entry>
  
  <entry>
    <title>iOSè‡ªå®šä¹‰æ¨¡æ€è§†å›¾è½¬åœº</title>
    <link href="http://wuqiuhao.github.io/2016/07/17/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E6%80%81%E8%A7%86%E5%9B%BE%E8%BD%AC%E5%9C%BA/"/>
    <id>http://wuqiuhao.github.io/2016/07/17/iOSè‡ªå®šä¹‰æ¨¡æ€è§†å›¾è½¬åœº/</id>
    <published>2016-07-17T02:47:08.000Z</published>
    <updated>2016-07-19T01:55:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬åœ¨ä½¿ç”¨æ·˜å®Appè´­ç‰©çš„æ—¶å€™ï¼Œç»å¸¸ç”¨åˆ°çš„ä¸€ä¸ªæ“ä½œå°±æ˜¯åŠ å…¥è´­ç‰©è½¦ï¼Œå¥½å¥‡çš„æœ‹å‹ä¸€å®šä¼šå‘ç°ï¼Œå½“æˆ‘ä»¬åœ¨ç‚¹å‡»åŠ å…¥è´­ç‰©è½¦æŒ‰é’®çš„æ—¶å€™å‡ºç°äº†ä¸€ä¸ªé…·ç‚«çš„åŠ¨ç”»ã€‚åŸæœ¬çš„è§†å›¾å‡ºç°äº†ä¸€å®šçš„æŠ˜å ä¹‹åï¼Œä»¿ä½›åµŒå…¥äº†å±å¹•å†…éƒ¨ï¼Œéšåå¼¹å‡ºå•†å“è¯¦ç»†å‚æ•°çš„é¡µé¢ã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯ä¸€ç§è‡ªå®šä¹‰çš„æ¨¡æ€è§†å›¾è½¬åœºåŠ¨ç”»ã€‚ä¸‹é¢æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åˆ†æå®ç°ç±»ä¼¼çš„æ¨¡æ€è§†å›¾è½¬åœºåŠ¨ç”»ã€‚</p>
<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><ul>
<li><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»º<code>GoodsViewController</code>å’Œ<code>GoodsDetailViewController</code>åˆ†åˆ«ä½œä¸ºå•†å“é¡µé¢å’Œå•†å“è¯¦ç»†é¡µé¢ã€‚åˆ›å»º<code>Shop.storyboard</code>,ä»¥åŠä¸¤ä¸ªViewControllerå¯¹åº”çš„è§†å›¾å¦‚ä¸‹ã€‚<br>  <img src="https://github.com/wuqiuhao/HCustomTransition/raw/master/resource/storyboard.png" alt="Shop.storyboard"></p>
</li>
<li><p>åˆ›å»º<code>CustomTransitioningDelegate</code>ä»£ç†ï¼Œç”¨äºdismissæ–¹æ³•å›è°ƒã€‚</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">protocol CustomTransitioningDelegate &#123;</div><div class="line">    // dismiss</div><div class="line">    func dismissPresentViewController()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>åˆ›å»º<code>CustomTransitioningAnimator</code>,ä½œä¸ºæˆ‘ä»¬æ‰€æœ‰è½¬åœºåŠ¨ç”»çš„æ€»ä»£ç†ã€‚æ²¡é”™ï¼è½¬åœºå¯¼è¯»éœ€è¦èŠ±å¤šå°‘æ—¶é—´ã€è½¬åœºè¯¥ä»¥æ€æ ·çš„åŠ¨ç”»è¿›è¡Œéƒ½æœ‰å®ƒæ¥æ§åˆ¶ã€‚</li>
</ul>
<h2 id="presentå‰çš„å…³é”®æ­¥å¥"><a href="#presentå‰çš„å…³é”®æ­¥å¥" class="headerlink" title="presentå‰çš„å…³é”®æ­¥å¥"></a>presentå‰çš„å…³é”®æ­¥å¥</h2><p>â€œç‚¹å‡»è´­ç‰©è½¦â€æŒ‰é’®çš„äº‹ä»¶å¤„ç†å¦‚ä¸‹,åœ¨è¿™é‡Œæ¯”è¾ƒé‡è¦çš„æ˜¯æˆ‘ä»¬éœ€è¦è®¾ç½®<code>modalPresentationStyle</code>ä¸º<code>Custom</code>ç±»å‹ï¼Œå¹¶æŠŠ<code>transitioningDelegate</code>è®¾ç½®ä¸º<code>CustomTransitioningAnimator</code>ç±»çš„å®ä¾‹<code>animator</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@IBAction func addGoodsToShopCart(sender: UIBarButtonItem) &#123;</div><div class="line">       let shopCartVC = UIStoryboard(name: &quot;Shop&quot;, bundle: nil).instantiateViewControllerWithIdentifier(&quot;GoodsDetailViewController&quot;) as! GoodsDetailViewController</div><div class="line">       animator = CustomTransitioningAnimator(presentViewController: shopCartVC)</div><div class="line">       shopCartVC.delegate = self</div><div class="line">       shopCartVC.modalPresentationStyle = UIModalPresentationStyle.Custom</div><div class="line">       shopCartVC.transitioningDelegate = animator</div><div class="line">       shopCartVC.panGesture = UIPanGestureRecognizer(target: animator, action: #selector(animator.handleGesture(_:)))</div><div class="line">       self.presentViewController(shopCartVC, animated: true, completion: nil)</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h2 id="CustomTransitioningAnimatorè§£æ"><a href="#CustomTransitioningAnimatorè§£æ" class="headerlink" title="CustomTransitioningAnimatorè§£æ"></a>CustomTransitioningAnimatorè§£æ</h2><h3 id="UIViewControllerTransitioningDelegateåè®®å®ç°"><a href="#UIViewControllerTransitioningDelegateåè®®å®ç°" class="headerlink" title="UIViewControllerTransitioningDelegateåè®®å®ç°"></a>UIViewControllerTransitioningDelegateåè®®å®ç°</h3><p>ç”±äºæˆ‘ä»¬ä¸Šä¸€æ­¥ä¸­æåˆ°çš„<code>transitioningDelegate</code>æ˜¯<code>UIViewControllerTransitioningDelegate</code>ç±»å‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„Animatorï¼ˆCustomTransitioningAnimatorä»¥ä¸‹éƒ½ç®€ç§°Animatorï¼‰é¦–å…ˆéœ€è¦å®ç°<code>UIViewControllerTransitioningDelegate</code>åè®®ã€‚</p>
<ul>
<li>è¿™å››ä¸ªæ–¹æ³•ç”¨äºè®¾å®špresentæˆ–dismissçš„åŠ¨ç”»çš„ä»£ç†å¯¹è±¡ï¼Œè®¾ç½®æˆselfåˆ™ç”±æœ¬ç±»çš„æ–¹æ³•å®ç°ï¼Œè®¾ç½®æˆnilåˆ™ä¸å¤„ç†ã€‚</li>
<li>å¦‚æœæ˜¯æ‰‹åŠ¿é©±åŠ¨çš„æƒ…å†µä¸‹ï¼Œéœ€è¦ä»£ç†å¯¹è±¡å®ç°<code>UIViewControllerInteractiveTransitioning</code>åè®®ï¼Œå¹¸è¿çš„æ˜¯ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›äº†<code>UIPercentDrivenInteractiveTransition</code>ç±»ï¼Œæ­¤ç±»æœ¬ç”Ÿå°±å®ç°äº†<code>UIViewControllerInteractiveTransitioning</code>åè®®ï¼Œæ”¯æŒç™¾åˆ†æ¯”å˜æ¢ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ‰©å±•<code>updateInteractiveTransition</code>ã€<code>finishInteractiveTransition</code>ã€<code>cancelInteractiveTransition</code>ç­‰æ–¹æ³•ï¼Œå¤§å¤§ç®€åŒ–äº†æ‰‹åŠ¿é©±åŠ¨ã€‚</li>
<li>å¦‚æœæ˜¯éæ‰‹åŠ¿é©±åŠ¨æˆ‘ä»¬çš„ç±»éœ€è¦å®ç°<code>UIViewControllerAnimatedTransitioning</code>åè®®</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">extension CustomTransitioningAnimator: UIViewControllerTransitioningDelegate &#123;</div><div class="line">    func animationControllerForPresentedController(presented: UIViewController, presentingController presenting: UIViewController, sourceController source: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? &#123;</div><div class="line">        isDismiss = false</div><div class="line">        return self</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    func animationControllerForDismissedController(dismissed: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? &#123;</div><div class="line">        isDismiss = true</div><div class="line">        return self</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    func interactionControllerForDismissal(animator: UIViewControllerAnimatedTransitioning) -&gt; UIViewControllerInteractiveTransitioning? &#123;</div><div class="line">        isDismiss = true</div><div class="line">        return self.interacting ? self : nil</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    func interactionControllerForPresentation(animator: UIViewControllerAnimatedTransitioning) -&gt; UIViewControllerInteractiveTransitioning? &#123;</div><div class="line">        isDismiss = false</div><div class="line">        return nil</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="éæ‰‹åŠ¿æƒ…å†µå¤„ç†"><a href="#éæ‰‹åŠ¿æƒ…å†µå¤„ç†" class="headerlink" title="éæ‰‹åŠ¿æƒ…å†µå¤„ç†"></a>éæ‰‹åŠ¿æƒ…å†µå¤„ç†</h3><p>åœ¨éæ‰‹åŠ¿çš„æƒ…å†µä¸‹ï¼Œä¸Šé¢æåˆ°äº†æˆ‘ä»¬éœ€è¦å®ç°<code>UIViewControllerAnimatedTransitioning</code>åè®®ã€‚<code>UIViewControllerAnimatedTransitioning</code>çš„æ–¹æ³•ä»‹ç»ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public func transitionDuration(transitionContext: UIViewControllerContextTransitioning?) -&gt; NSTimeInterval // ç”¨äºè®¾ç½®è½¬åœºåŠ¨ç”»çš„æ—¶é—´</div><div class="line">public func animateTransition(transitionContext: UIViewControllerContextTransitioning) // åŠ¨ç”»çš„å…·ä½“å®ç°ç»†èŠ‚</div><div class="line">optional public func animationEnded(transitionCompleted: Bool) // åŠ¨ç”»å®Œæˆæ—¶è°ƒç”¨</div></pre></td></tr></table></figure>
<p>   éæ‰‹åŠ¿æƒ…å†µå®ç°å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line">// éæ‰‹åŠ¿æƒ…å†µ</div><div class="line">extension CustomTransitioningAnimator: UIViewControllerAnimatedTransitioning &#123;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     åŠ¨ç”»æŒç»­æ—¶é—´</div><div class="line">     </div><div class="line">     - parameter transitionContext:</div><div class="line">     </div><div class="line">     - returns:</div><div class="line">     */</div><div class="line">    func transitionDuration(transitionContext: UIViewControllerContextTransitioning?) -&gt; NSTimeInterval &#123;</div><div class="line">        return 0.25</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     åŠ¨ç”»æ‰§è¡Œæ•ˆæœ</div><div class="line">     </div><div class="line">     - parameter transitionContext:</div><div class="line">     */</div><div class="line">    func animateTransition(transitionContext: UIViewControllerContextTransitioning) &#123;</div><div class="line">        /**</div><div class="line">         *  å¦‚æœæ˜¯æ‰‹åŠ¿é©±åŠ¨çš„ç›´æ¥è¿”å›</div><div class="line">         */</div><div class="line">        guard !interacting else &#123;</div><div class="line">            return</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        let toViewController = transitionContext.viewControllerForKey(UITransitionContextToViewControllerKey)!</div><div class="line">        let fromViewController = transitionContext.viewControllerForKey(UITransitionContextFromViewControllerKey)!</div><div class="line">        </div><div class="line">        /**</div><div class="line">         *  åˆ¤æ–­æ˜¯å¦æ˜¯dismissçš„åŠ¨ç”»è¿˜æ˜¯presentçš„åŠ¨ç”»</div><div class="line">         */</div><div class="line">        if isDismiss! &#123;</div><div class="line">            let finalFrame = CGRect(x: 0, y: 0, width: UIScreen.mainScreen().bounds.width, height: UIScreen.mainScreen().bounds.height)</div><div class="line">            UIView.animateWithDuration(transitionDuration(transitionContext), delay: 0, options: UIViewAnimationOptions.CurveEaseIn, animations: &#123;</div><div class="line">                fromViewController.view.frame = CGRect(x: 0, y: UIScreen.mainScreen().bounds.height, width: UIScreen.mainScreen().bounds.width, height: UIScreen.mainScreen().bounds.height)</div><div class="line">                var transform = CATransform3DIdentity</div><div class="line">                transform.m24 = -1/5000</div><div class="line">                transform = CATransform3DScale(transform, 0.95, 0.95, 1)</div><div class="line">                toViewController.view.layer.transform = transform</div><div class="line">                toViewController.view.alpha = 1</div><div class="line">            &#125;) &#123; (finished) in</div><div class="line">                if finished &#123;</div><div class="line">                    UIView.animateWithDuration(self.transitionDuration(transitionContext), delay: 0, options: UIViewAnimationOptions.CurveEaseIn, animations: &#123;</div><div class="line">                        toViewController.view.layer.transform = CATransform3DIdentity</div><div class="line">                        toViewController.view.frame = finalFrame</div><div class="line">                    &#125;) &#123; (finished) in</div><div class="line">                       transitionContext.completeTransition(true)</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125; else &#123;</div><div class="line">            transitionContext.containerView()?.addSubview(toViewController.view)</div><div class="line">            let finalFrame = CGRect(x: 0, y: 0, width: UIScreen.mainScreen().bounds.width, height: UIScreen.mainScreen().bounds.height)</div><div class="line">            toViewController.view.frame = CGRectOffset(finalFrame, 0, UIScreen.mainScreen().bounds.height)</div><div class="line">            UIView.animateWithDuration(transitionDuration(transitionContext), delay: 0, options: UIViewAnimationOptions.CurveEaseOut, animations: &#123;</div><div class="line">                var transform = CATransform3DIdentity</div><div class="line">                transform.m24 = -1/2000</div><div class="line">                fromViewController.view.alpha = 0.5</div><div class="line">                fromViewController.view.layer.transform = transform</div><div class="line">                toViewController.view.frame = finalFrame</div><div class="line">            &#125;) &#123; (finished) in</div><div class="line">                if finished &#123;</div><div class="line">                    UIView.animateWithDuration(self.transitionDuration(transitionContext), delay: 0, options: UIViewAnimationOptions.CurveEaseOut, animations: &#123;</div><div class="line">                        var transform = CATransform3DIdentity</div><div class="line">                        transform = CATransform3DTranslate(transform, 0, -15, 0)</div><div class="line">                        transform = CATransform3DScale(transform, 0.8,0.9, 1)</div><div class="line">                        fromViewController.view.layer.transform = transform</div><div class="line">                    &#125;) &#123; (finished) in</div><div class="line">                        if finished &#123;</div><div class="line">                            transitionContext.completeTransition(true)</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="æ‰‹åŠ¿æƒ…å†µå¤„ç†"><a href="#æ‰‹åŠ¿æƒ…å†µå¤„ç†" class="headerlink" title="æ‰‹åŠ¿æƒ…å†µå¤„ç†"></a>æ‰‹åŠ¿æƒ…å†µå¤„ç†</h3><p>æ‰‹åŠ¿æ“ä½œæˆ‘ä»¬ä¸Šé¢æåˆ°äº†ï¼Œåªè¦ç»§æ‰¿<code>UIPercentDrivenInteractiveTransition</code>è¿™ä¸ªç±»ï¼Œå°±å¯ä»¥å¾ˆæ–¹é¢çš„å®ç°æ‰‹åŠ¿æ“ä½œä»¥åŠç™¾åˆ†æ¯”åŠ¨ç”»ã€‚<code>UIPercentDrivenInteractiveTransition</code>æœ‰å‡ ä¸ªä¸»è¦çš„æ–¹æ³•ä»‹ç»å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public func startInteractiveTransition(transitionContext: UIViewControllerContextTransitioning) // å®ç°è‡ª`UIViewControllerInteractiveTransitioning`åè®®ï¼Œæ‰‹åŠ¿åˆšè§¦å‘æ—¶è°ƒç”¨</div><div class="line">public func updateInteractiveTransition(percentComplete: CGFloat) // æ‰‹åŠ¿è§¦å‘è¿‡ç¨‹ä¸­ä¸æ–­è°ƒç”¨ï¼Œå‚æ•°ä¸ºç™¾åˆ†æ¯”0~1ã€‚</div><div class="line">public func cancelInteractiveTransition() // æ‰‹åŠ¿å–æ¶ˆæ—¶è°ƒç”¨</div><div class="line">public func finishInteractiveTransition() // æ‰‹åŠ¿è¾¾åˆ°ä¸€å®šç¨‹åº¦æˆåŠŸæ—¶è°ƒç”¨</div></pre></td></tr></table></figure>
<p>æ‰‹åŠ¿æ“ä½œç™¾åˆ†æ¯”åŠ¨ç”»çš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div></pre></td><td class="code"><pre><div class="line">class CustomTransitioningAnimator: UIPercentDrivenInteractiveTransition &#123;</div><div class="line">    </div><div class="line">    var isDismiss: Bool!</div><div class="line">    weak var presentViewController: UIViewController!</div><div class="line">    var transitionContext: UIViewControllerContextTransitioning!</div><div class="line">    // æ˜¯å¦å¤„äºäº¤äº’è§†å›¾åˆ‡æ¢è¿‡ç¨‹</div><div class="line">    var interacting = false</div><div class="line">    // æ˜¯å¦æ‰‹åŠ¿å®Œæˆ</div><div class="line">    var shouleComplete = true</div><div class="line">    </div><div class="line">    init(presentViewController: UIViewController) &#123;</div><div class="line">        super.init()</div><div class="line">        self.presentViewController = presentViewController</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// MARK: - æ‰‹åŠ¿æ“ä½œ</div><div class="line">extension CustomTransitioningAnimator &#123;</div><div class="line">    /**</div><div class="line">     å¤„ç†æ‰‹åŠ¿æ“ä½œ</div><div class="line">     </div><div class="line">     - parameter gestureRecognizer:</div><div class="line">     */</div><div class="line">    func handleGesture(gestureRecognizer: UIPanGestureRecognizer) &#123;</div><div class="line">        let translation = gestureRecognizer.translationInView(gestureRecognizer.view)</div><div class="line">        switch gestureRecognizer.state &#123;</div><div class="line">        case UIGestureRecognizerState.Began:</div><div class="line">            interacting = true</div><div class="line">            if presentViewController is GoodsDetailViewController &#123;</div><div class="line">                (presentViewController as! GoodsDetailViewController).delegate?.dismissPresentViewController()</div><div class="line">            &#125;</div><div class="line">        case .Changed:</div><div class="line">            var fraction = translation.y / 200.0</div><div class="line">            fraction = fmin(fmax(fraction, 0.0), 1.0)</div><div class="line">            shouleComplete = fraction &gt; 0.5</div><div class="line">            self.updateInteractiveTransition(fraction)</div><div class="line">        case .Ended, .Cancelled:</div><div class="line">            interacting = false</div><div class="line">            if !shouleComplete || gestureRecognizer.state == .Cancelled || gestureRecognizer.velocityInView(gestureRecognizer.view).y &lt; 0 &#123;</div><div class="line">                self.cancelInteractiveTransition()</div><div class="line">            &#125; else &#123;</div><div class="line">                self.finishInteractiveTransition()</div><div class="line">            &#125;</div><div class="line">        default:</div><div class="line">            break</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     å¼€å§‹æ‰‹åŠ¿æ‹–æ‹½</div><div class="line">     </div><div class="line">     - parameter transitionContext:</div><div class="line">     */</div><div class="line">    override func startInteractiveTransition(transitionContext: UIViewControllerContextTransitioning) &#123;</div><div class="line">        let toViewController = transitionContext.viewControllerForKey(UITransitionContextToViewControllerKey)!</div><div class="line">        self.transitionContext = transitionContext</div><div class="line">        UIView.animateWithDuration(transitionDuration(transitionContext)) &#123;</div><div class="line">            var transform = CATransform3DIdentity</div><div class="line">            transform = CATransform3DTranslate(transform, 0, 15, 0)</div><div class="line">            transform.m24 = -1/5000</div><div class="line">            transform = CATransform3DScale(transform, 0.85, 1 , 1)</div><div class="line">            toViewController.view.layer.transform = transform</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     æ‰‹åŠ¿æ‹–åŠ¨è¿‡ç¨‹ä¸­ä¸æ–­æ›´æ–°</div><div class="line">     </div><div class="line">     - parameter percentComplete: æ›´æ–°ç™¾åˆ†æ¯”0~1</div><div class="line">     */</div><div class="line">    override func updateInteractiveTransition(percentComplete: CGFloat) &#123;</div><div class="line">        guard let _ = transitionContext else &#123;</div><div class="line">            return</div><div class="line">        &#125;</div><div class="line">        let toViewController = transitionContext.viewControllerForKey(UITransitionContextToViewControllerKey)!</div><div class="line">        var transform = CATransform3DIdentity</div><div class="line">        transform.m24 = -1/3500 + 1/3500 * percentComplete</div><div class="line">        transform = CATransform3DScale(transform, 0.85 + 0.15 * percentComplete, 0.9 + 0.1 * percentComplete , 1)</div><div class="line">        toViewController.view.layer.transform = transform</div><div class="line">        toViewController.view.alpha = 0.5 + 0.5 * percentComplete</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     å®Œæˆæ‰‹åŠ¿dismiss</div><div class="line">     */</div><div class="line">    override func finishInteractiveTransition() &#123;</div><div class="line">        let finalFrame = CGRect(x: 0, y: 0, width: UIScreen.mainScreen().bounds.width, height: UIScreen.mainScreen().bounds.height)</div><div class="line">        let toViewController = transitionContext.viewControllerForKey(UITransitionContextToViewControllerKey)!</div><div class="line">        let fromViewController = transitionContext.viewControllerForKey(UITransitionContextFromViewControllerKey)!</div><div class="line">        UIView.animateWithDuration(2 * transitionDuration(transitionContext), animations: &#123;</div><div class="line">            fromViewController.view.frame = CGRect(x: 0, y: UIScreen.mainScreen().bounds.height, width: UIScreen.mainScreen().bounds.width, height: UIScreen.mainScreen().bounds.height)</div><div class="line">            toViewController.view.layer.transform = CATransform3DIdentity</div><div class="line">            toViewController.view.alpha = 1</div><div class="line">            toViewController.view.frame = finalFrame</div><div class="line">        &#125;) &#123; (finished) in</div><div class="line">            if finished &#123;</div><div class="line">                self.transitionContext.completeTransition(true)</div><div class="line">                self.transitionContext = nil</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /**</div><div class="line">     æ‰‹åŠ¿å–æ¶ˆæ“ä½œ</div><div class="line">     */</div><div class="line">    override func cancelInteractiveTransition() &#123;</div><div class="line">        let fromViewController = transitionContext.viewControllerForKey(UITransitionContextFromViewControllerKey)!</div><div class="line">        let toViewController = transitionContext.viewControllerForKey(UITransitionContextToViewControllerKey)!</div><div class="line">        UIView.animateWithDuration(transitionDuration(transitionContext), delay: 0, options: UIViewAnimationOptions.CurveEaseOut, animations: &#123; () -&gt; Void in</div><div class="line">            fromViewController.view.userInteractionEnabled = false</div><div class="line">            fromViewController.view.frame = CGRect(x: 0, y: 0, width: fromViewController.view.frame.width, height: fromViewController.view.frame.height)</div><div class="line">        &#125;) &#123; (finished) -&gt; Void in</div><div class="line">            if finished &#123;</div><div class="line">                UIView.animateWithDuration(self.transitionDuration(self.transitionContext), delay: 0, options: UIViewAnimationOptions.CurveEaseOut, animations: &#123;</div><div class="line">                    var transform = CATransform3DIdentity</div><div class="line">                    transform = CATransform3DTranslate(transform, 0, -15, 0)</div><div class="line">                    transform = CATransform3DScale(transform, 0.8,0.9, 1)</div><div class="line">                    toViewController.view.layer.transform = transform</div><div class="line">                    toViewController.view.alpha = 0.5</div><div class="line">                &#125;) &#123; (finished) in</div><div class="line">                    if finished &#123;</div><div class="line">                        fromViewController.view.userInteractionEnabled = true</div><div class="line">                        self.transitionContext.completeTransition(false)</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="æºç åˆ†äº«"><a href="#æºç åˆ†äº«" class="headerlink" title="æºç åˆ†äº«"></a>æºç åˆ†äº«</h2><p>Githubåœ°å€ï¼š<a href="https://github.com/wuqiuhao/HCustomTransition" target="_blank" rel="external">HCustomTransition</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æˆ‘ä»¬åœ¨ä½¿ç”¨æ·˜å®Appè´­ç‰©çš„æ—¶å€™ï¼Œç»å¸¸ç”¨åˆ°çš„ä¸€ä¸ªæ“ä½œå°±æ˜¯åŠ å…¥è´­ç‰©è½¦ï¼Œå¥½å¥‡çš„æœ‹å‹ä¸€å®šä¼šå‘ç°ï¼Œå½“æˆ‘ä»¬åœ¨ç‚¹å‡»åŠ å…¥è´­ç‰©è½¦æŒ‰é’®çš„æ—¶å€™å‡ºç°äº†ä¸€ä¸ªé…·ç‚«çš„åŠ¨ç”»ã€‚åŸæœ¬çš„è§†å›¾å‡ºç°äº†ä¸€å®šçš„æŠ˜å ä¹‹åï¼Œä»¿ä½›åµŒå…¥äº†å±å¹•å†…éƒ¨ï¼Œéšåå¼¹å‡ºå•†å“è¯¦ç»†å‚æ•°çš„é¡µé¢ã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯ä¸€ç§è‡ªå®šä¹‰çš„æ¨¡æ€è§†å›¾è½¬åœºåŠ¨ç”»ã€‚ä¸‹é¢æˆ‘ä»¬ä¸€
    
    </summary>
    
      <category term="iOS" scheme="http://wuqiuhao.github.io/categories/iOS/"/>
    
    
      <category term="Custom Transition" scheme="http://wuqiuhao.github.io/tags/Custom-Transition/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨fastlane gymå®ç°ipaè‡ªåŠ¨æ‰“åŒ…è„šæœ¬</title>
    <link href="http://wuqiuhao.github.io/2016/06/08/fastlane%20gym%E5%AE%9E%E7%8E%B0ipa%E8%87%AA%E5%8A%A8%E6%89%93%E5%8C%85%E8%84%9A%E6%9C%AC/"/>
    <id>http://wuqiuhao.github.io/2016/06/08/fastlane gymå®ç°ipaè‡ªåŠ¨æ‰“åŒ…è„šæœ¬/</id>
    <published>2016-06-08T09:07:53.000Z</published>
    <updated>2016-06-08T09:24:01.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="fastlane"><a href="#fastlane" class="headerlink" title="fastlane"></a>fastlane</h3><p>fastlaneæ˜¯ä¸€ç»„å·¥å…·å¥—ä»¶ï¼Œæ—¨åœ¨å®ç°iOSåº”ç”¨å‘å¸ƒæµç¨‹çš„è‡ªåŠ¨åŒ–ï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªè¿è¡Œè‰¯å¥½çš„æŒç»­éƒ¨ç½²æµç¨‹ï¼Œåªéœ€è¦è¿è¡Œä¸€ä¸ªç®€å•çš„å‘½ä»¤å°±å¯ä»¥è§¦å‘è¿™ä¸ªæµç¨‹ã€‚</p>
<p>fastlaneæ˜¯ä¸€ä¸ªrubyè„šæœ¬é›†åˆï¼Œå…¶ä¸­å›Šæ‹¬äº†å‘è‹¹æœå•†åº—æäº¤æ–°åº”ç”¨æˆ–æ›´æ–°å·²æœ‰åº”ç”¨æ‰€éœ€è¦çš„æœ€å¸¸ç”¨ä»»åŠ¡ã€‚</p>
<ul>
<li>deliverç”¨äºä¸Šä¼ åº”ç”¨çš„äºŒè¿›åˆ¶ä»£ç ï¼Œåº”ç”¨æˆªå±å’ŒåŸæ•°æ®åˆ°åº”ç”¨å•†åº—</li>
<li>snapshotå¯ä»¥è‡ªåŠ¨åŒ–iOSåº”ç”¨åœ¨æ¯ä¸ªè®¾å¤‡ä¸Šçš„æœ¬åœ°åŒ–æˆªå±è¿‡ç¨‹</li>
<li>frameitç”¨äºåœ¨åº”ç”¨æˆªå±å¤–æ·»åŠ è®¾å¤‡æ¡†æ¶</li>
<li>PEMå¯ä»¥è‡ªåŠ¨åŒ–åœ°ç”Ÿæˆå’Œæ›´æ–°åº”ç”¨æ¨é€é€šçŸ¥æè¿°æ–‡ä»¶</li>
<li>sighå¯ä»¥ç”Ÿæˆå¹¶ä¸‹è½½å¼€å‘è€…çš„åº”ç”¨å•†åº—é…ç½®æ–‡ä»¶</li>
</ul>
<h3 id="ä½¿ç”¨fastlane-gymæ‰“åŒ…"><a href="#ä½¿ç”¨fastlane-gymæ‰“åŒ…" class="headerlink" title="ä½¿ç”¨fastlane gymæ‰“åŒ…"></a>ä½¿ç”¨fastlane gymæ‰“åŒ…</h3><h4 id="å®‰è£…gym"><a href="#å®‰è£…gym" class="headerlink" title="å®‰è£…gym"></a>å®‰è£…gym</h4><p>é¦–å…ˆéœ€è¦å®‰è£…rubyç¯å¢ƒï¼Œç„¶ååœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ï¼š</p>
<p><code>sudo gem install gym</code></p>
<h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><ul>
<li>*.workspaceæ–‡ä»¶</li>
</ul>
<p>ä½¿ç”¨<code>CocoaPods</code>ç®¡ç†çš„å·¥ç¨‹åœ¨æ‰§è¡Œå®Œ<code>pod install</code>ä¹‹åç”Ÿæˆçš„workspaceæ–‡ä»¶</p>
<ul>
<li>scheme</li>
</ul>
<p>æ˜¾ç¤ºåœ¨Xcodeçš„å·¦ä¸Šè§’ï¼Œrunå›¾æ ‡çš„å³è¾¹ï¼Œè®¾å¤‡é€‰æ‹©çš„å·¦è¾¹</p>
<ul>
<li>configuration</li>
</ul>
<p>åœ¨Xcodeä¸­é€‰é¡¹ç›®ï¼ŒInfo tabä¸‹ä¼šåˆ—å‡ºæ‰€æœ‰çš„configurationï¼Œä¸€èˆ¬æœ‰Debugå’ŒReleaseä¸¤ç§</p>
<ul>
<li>provisioning profile</li>
</ul>
<p>åœ¨Xcodeä¸­é€‰targetï¼Œåœ¨Build Settings tabä¸‹æœç´¢Provisioning Profileï¼Œé»˜è®¤åº”è¯¥æ˜¯Automaticï¼Œç‚¹å‡»çœ‹åˆ°ä¸‹æ‹‰åˆ—è¡¨ä¸­çš„å°±æ˜¯æ‰€æœ‰å¯ç”¨çš„åç§°</p>
<h4 id="è„šæœ¬æ‰§è¡Œæ­¥éª¤"><a href="#è„šæœ¬æ‰§è¡Œæ­¥éª¤" class="headerlink" title="è„šæœ¬æ‰§è¡Œæ­¥éª¤"></a>è„šæœ¬æ‰§è¡Œæ­¥éª¤</h4><ol>
<li><p>æ¸…ç†é¡¹ç›®</p>
</li>
<li><p>ç”Ÿæˆarchive</p>
</li>
<li><p>å¯¼å‡ºipa</p>
</li>
<li><p>ä¸Šä¼ åˆ°fir</p>
</li>
</ol>
<h4 id="ä¸Šè„šæœ¬"><a href="#ä¸Šè„šæœ¬" class="headerlink" title="ä¸Šè„šæœ¬"></a>ä¸Šè„šæœ¬</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"></div><div class="line">#è®¡æ—¶</div><div class="line">SECONDS=0</div><div class="line">project_path=$(pwd)</div><div class="line">now=$(date +&quot;%Y_%m_%d_%H_%M_%S&quot;)</div><div class="line">current_user=$(logname)</div><div class="line">scheme=&quot;your scheme name&quot;</div><div class="line"></div><div class="line">configuration=&quot;Release&quot;</div><div class="line">#æŒ‡å®šæ‰“åŒ…æ‰€ä½¿ç”¨çš„è¾“å‡ºæ–¹å¼ï¼Œç›®å‰æ”¯æŒapp-store, package, ad-hoc, enterprise, development, å’Œdeveloper-idï¼Œå³xcodebuildçš„methodå‚æ•°</div><div class="line">export_method=&apos;ad-hoc&apos;</div><div class="line"></div><div class="line">workspace_path=&quot;$project_path/$scheme.xcworkspace&quot;</div><div class="line"></div><div class="line">output_path=&quot;/Users/$current_user/Desktop&quot;</div><div class="line"></div><div class="line">archive_path=&quot;$output_path/$scheme$&#123;now&#125;.xcarchive&quot;</div><div class="line"></div><div class="line">ipa_path=&quot;$output_path/$scheme$&#123;now&#125;.ipa&quot;</div><div class="line"></div><div class="line">ipa_name=&quot;$scheme$&#123;now&#125;.ipa&quot;</div><div class="line"></div><div class="line">commit_msg=&quot;$1&quot;</div><div class="line"></div><div class="line">fir_token=&quot;your fir token&quot;</div><div class="line"></div><div class="line">#è¾“å‡ºè®¾å®šçš„å˜é‡å€¼</div><div class="line">echo &quot;===workspace path: $&#123;workspace_path&#125;===&quot;</div><div class="line">echo &quot;===archive path: $&#123;archive_path&#125;===&quot;</div><div class="line">echo &quot;===ipa path: $&#123;ipa_path&#125;===&quot;</div><div class="line">echo &quot;===export method: $&#123;export_method&#125;===&quot;</div><div class="line">echo &quot;===commit msg: $1===&quot;</div><div class="line"></div><div class="line">#å…ˆæ¸…ç©ºå‰ä¸€æ¬¡build</div><div class="line">gym --workspace $&#123;workspace_path&#125; --scheme $&#123;scheme&#125; -clean --configuration $&#123;configuration&#125; --archive_path $&#123;archive_path&#125; --export_method $&#123;export_method&#125; --output_directory $&#123;output_path&#125; --output_name $&#123;ipa_name&#125;</div><div class="line"></div><div class="line">#ä¸Šä¼ åˆ°fir</div><div class="line">#fir publish $&#123;ipa_path&#125; -T &quot;$&#123;fir_token&#125;&quot; -c &quot;$&#123;commit_msg&#125;&quot;</div><div class="line"></div><div class="line">#è¾“å‡ºæ€»ç”¨æ—¶</div><div class="line">echo &quot;===Finished. Total time: $&#123;SECONDS&#125;s===&quot;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;fastlane&quot;&gt;&lt;a href=&quot;#fastlane&quot; class=&quot;headerlink&quot; title=&quot;fastlane&quot;&gt;&lt;/a&gt;fastlane&lt;/h3&gt;&lt;p&gt;fastlaneæ˜¯ä¸€ç»„å·¥å…·å¥—ä»¶ï¼Œæ—¨åœ¨å®ç°iOSåº”ç”¨å‘å¸ƒæµç¨‹çš„è‡ªåŠ¨åŒ–ï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªè¿è¡Œè‰¯å¥½çš„æŒ
    
    </summary>
    
      <category term="iOS" scheme="http://wuqiuhao.github.io/categories/iOS/"/>
    
    
      <category term="è‡ªåŠ¨æ‰“åŒ…" scheme="http://wuqiuhao.github.io/tags/%E8%87%AA%E5%8A%A8%E6%89%93%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>Swiftä¸­çš„ç”Ÿæˆå™¨å’Œåºåˆ—</title>
    <link href="http://wuqiuhao.github.io/2016/06/02/Swift%E4%B8%AD%E7%9A%84%E7%94%9F%E6%88%90%E5%99%A8%E5%92%8C%E5%BA%8F%E5%88%97/"/>
    <id>http://wuqiuhao.github.io/2016/06/02/Swiftä¸­çš„ç”Ÿæˆå™¨å’Œåºåˆ—/</id>
    <published>2016-06-02T14:00:05.000Z</published>
    <updated>2016-06-02T15:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç”Ÿæˆå™¨(Generators)ä¸åºåˆ—(Sequences)æ„æˆäº†Swiftå¼å¾ªç¯ã€‚</p>
<h2 id="ç”Ÿæˆå™¨-Generators"><a href="#ç”Ÿæˆå™¨-Generators" class="headerlink" title="ç”Ÿæˆå™¨(Generators)"></a>ç”Ÿæˆå™¨(Generators)</h2><p>æåˆ°æ•°ç»„æˆ‘ä»¬å°±ä¼šæƒ³åˆ°éå†ï¼Œä¸€èˆ¬çš„éå†å¯èƒ½éƒ½æ˜¯ä»å¤´åˆ°å°¾è¿›è¡Œçš„ã€‚ä½†æ˜¯å¦‚æœä½ æœ‰ç‰¹æ®Šçš„éœ€æ±‚å‘¢ã€‚ä½ å¯èƒ½ä¸æƒ³å‘†æ¿çš„è¿›è¡Œéå†ã€‚è¿™æ—¶å€™Generatorså°±å¯ä»¥æ´¾ä¸Šç”¨åœºäº†ã€‚<br>Generatorsçš„å­˜åœ¨æ˜¯è¿›è¡Œç‰¹æ®Šç™–å¥½çš„æ•°ç»„éå†ï¼Œå…¶ç­›é€‰å‡ºç¬¦åˆè¯¥ç™–å¥½çš„ä¸‹æ ‡ç´¢å¼•åˆ°æ•°ç»„æ²¡æœ‰å…ƒç´ ä¸ºæ­¢ã€‚<br>ä»»æ„ä¸€ä¸ªgeneratoréƒ½éœ€è¦éµä»å¦‚ä¸‹åè®®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">protocol GeneratorType &#123; </div><div class="line">    associatedtype Element</div><div class="line">    func next() -&gt; Element?</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ ¹æ®ä¸Šè¿°åè®®ï¼Œè¯¥åè®®éœ€è¦å…ƒç´ ç±»å‹ä»¥åŠä¸€ä¸ªnext()å‡½æ•°ã€‚</p>
<p>ä¸¾ä¸ªå€’åºç´¢å¼•çš„generatorï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">class CountdownGenerator: GeneratorType &#123;</div><div class="line">    typealias Element = Int</div><div class="line">    var element: Element</div><div class="line"></div><div class="line">    init&lt;T&gt;(array: [T]) &#123;</div><div class="line">        self.element = array.count - 1</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    func next() -&gt; Element? &#123;</div><div class="line">        return self.element &lt; 0 ? nil : element--</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">let xs = [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]</div><div class="line">let generator = CountdownGenerator(array: xs)</div><div class="line">while let i = generator.next() &#123;</div><div class="line">    println(&quot;Element \(i) of the array is \(xs[i])&quot;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<p>Element 2 of the array is C</p>
<p>Element 1 of the array is B</p>
<p>Element 0 of the array is A</p>
<p>ä¼˜ç‚¹ï¼š</p>
<p>å°½ç®¡è¿™ä¸ªå°ä¾‹å­çœ‹èµ·æ¥æœ‰ç‚¹å°é¢˜å¤§åšï¼Œå¯ç”Ÿæˆå™¨å´å°è£…äº†æ•°ç»„åºåˆ—å€¼çš„è®¡ç®—ã€‚å¦‚æœä½ æƒ³è¦ç”¨å¦ä¸€ç§æ–¹å¼æ’åºåºåˆ—å€¼ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ–°ç”Ÿæˆå™¨ï¼Œè€Œä¸å¿…å†ä¿®æ”¹è¿™é‡Œçš„ä»£ç ã€‚</p>
<h2 id="åºåˆ—-Sequences"><a href="#åºåˆ—-Sequences" class="headerlink" title="åºåˆ—(Sequences)"></a>åºåˆ—(Sequences)</h2><p>Generatorsåœ¨å¾ªç¯è¿‡ç¨‹ä¸­æ¯ä¸ªå…ƒç´ æä¾›çš„æœåŠ¡æ˜¯ä¸€æ¬¡æ€§çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æƒ³åšå€’å›æ“ä½œçš„è¯éœ€è¦ç”Ÿæˆä¸€ä¸ªæ–°çš„generatorã€‚è‹¥ä¸æƒ³è¿™æ ·åˆ™éœ€è¦ç”¨ä¸Šsequenceï¼Œå…¶éµä»å¦å¤–ä¸€ä¸ªåè®®SequenceTypeï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">protocol SequenceType &#123;</div><div class="line">    associatedtype Generator: GeneratorType </div><div class="line">    func generate() -&gt; Generator</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é€šè¿‡åè®®æˆ‘ä»¬çŸ¥é“æ¯ä¸ªsequenceéƒ½ä¸ä¸€ä¸ªgeneratorç±»å‹å·²ç»ä¸€ä¸ªgeneratoræ„é€ å™¨ç»‘å®šåœ¨ä¸€èµ·ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªéå†sequenceã€‚<br>ä¸¾ä¸ªæ —å­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨CountdownGeneratoræ¥å®šä¹‰ä¸€ä¸ªsequenceä»è€Œç”Ÿæˆä¸€ä¸ªå€’åºçš„æ•°ç»„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">struct ReverseSequence&lt;T&gt;: SequenceType &#123;</div><div class="line">    var array: [T]</div><div class="line">    init(array: [T]) &#123;</div><div class="line">        self.array = array</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    typealias Generator = CountdownGenerator</div><div class="line"></div><div class="line">    func generate() -&gt; Generator &#123;</div><div class="line">        return CountdownGenerator(array: array)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">let xs = [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]</div><div class="line">let reverseSequence = ReverseSequence(array: xs)</div><div class="line">let reverseGenerator = reverseSequence.generate()</div><div class="line">while let i = reverseGenerator.next() &#123;</div><div class="line">    println(&quot;Index \(i) is \(xs[i])&quot;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<p>Index 2 is C</p>
<p>Index 1 is B</p>
<p>Index 0 is A</p>
<p>Swiftåœ¨å¤„ç†åºåˆ—æ—¶æœ‰ä¸€ä¸ªç‰¹åˆ«çš„è¯­æ³•ã€‚ä¸åŒäºåˆ›å»ºä¸€ä¸ªåºåˆ—çš„å…³è”ç”Ÿæˆå™¨ï¼Œä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªfor-inå¾ªç¯ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ä¸Šé¢çš„ä»£ç æ®µå†™æˆè¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">for i in ReverseSequence(array: xs) &#123;</div><div class="line">	print(&quot;Index \(i) is \(xs[i ])&quot;)&#125;</div></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<p>Index 2 is C</p>
<p>Index 1 is B</p>
<p>Index 0 is A</p>
<p>å®é™…ä¸Šï¼ŒSwiftåšçš„åªæ˜¯ä½¿ç”¨generateæ–¹æ³•ç”Ÿæˆäº†ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œç„¶åé‡å¤åœ°è°ƒç”¨å…¶nextå‡½æ•°ç›´åˆ°è¿”å›nilã€‚</p>
<p>ä¼˜ç‚¹ï¼š</p>
<p>å¯¹æ¯”ä¹‹å‰ä»…ä»…ä½¿ç”¨ç”Ÿæˆå™¨çš„ä¾‹å­ï¼ŒåŒä¸€ä¸ªåºåˆ—å¯ä»¥è¢«ç¬¬äºŒæ¬¡éå†â€“ä¸ºæ­¤æˆ‘ä»¬åªéœ€è¦è°ƒç”¨generateæ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ç”Ÿæˆå™¨å°±å¯ä»¥äº†ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ç”Ÿæˆå™¨(Generators)ä¸åºåˆ—(Sequences)æ„æˆäº†Swiftå¼å¾ªç¯ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç”Ÿæˆå™¨-Generators&quot;&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://wuqiuhao.github.io/categories/iOS/"/>
    
    
      <category term="GeneratorType" scheme="http://wuqiuhao.github.io/tags/GeneratorType/"/>
    
      <category term="SequenceType" scheme="http://wuqiuhao.github.io/tags/SequenceType/"/>
    
  </entry>
  
  <entry>
    <title>iOSè§†é¢‘ã€éŸ³é¢‘æ’­æ”¾</title>
    <link href="http://wuqiuhao.github.io/2016/04/05/iOS%E8%A7%86%E9%A2%91%E3%80%81%E9%9F%B3%E9%A2%91%E6%92%AD%E6%94%BE/"/>
    <id>http://wuqiuhao.github.io/2016/04/05/iOSè§†é¢‘ã€éŸ³é¢‘æ’­æ”¾/</id>
    <published>2016-04-05T05:04:53.000Z</published>
    <updated>2016-04-16T08:56:43.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€AVPlayerViewController"><a href="#ä¸€ã€AVPlayerViewController" class="headerlink" title="ä¸€ã€AVPlayerViewController"></a>ä¸€ã€AVPlayerViewController</h2><p>iOS9ä¹‹å‰ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨<code>MPMoviePlayerController</code>å®ç°è§†é¢‘ã€éŸ³é¢‘æ–‡ä»¶çš„æ’­æ”¾ã€‚iOS9ä¹‹åï¼ŒMPMoviePlayerControllerè¢«è‹¹æœå¼ƒç”¨ï¼Œè‹¹æœæ¨èä½¿ç”¨<code>AVPlayerViewController</code>ï¼ŒAVPlayerViewControllerçš„åŠŸèƒ½æ¯”MPMoviePlayerControlleræ›´ä¸ºå¼ºå¤§ã€‚å•ç‹¬ä½¿ç”¨AVPlayeræˆ‘ä»¬å°±å¯ä»¥å®ç°è§†é¢‘å’ŒéŸ³é¢‘ä¸¤ç§æ–‡ä»¶çš„æ’­æ”¾ã€‚ç”±äºå…¶åŸºäºAVFoundationå’ŒAVKitï¼Œæ‰€ä»¥åœ¨å¼€å§‹ä½¿ç”¨ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆå¯¼å…¥<code>AVFoundation</code>æ¡†æ¶ã€‚å…·ä½“å®ç°å¦‚ä¸‹:</p>
<h3 id="åŠ è½½æœ¬åœ°è§†é¢‘èµ„æº"><a href="#åŠ è½½æœ¬åœ°è§†é¢‘èµ„æº" class="headerlink" title="åŠ è½½æœ¬åœ°è§†é¢‘èµ„æº"></a>åŠ è½½æœ¬åœ°è§†é¢‘èµ„æº</h3><p>å¦‚æœéœ€è¦åŠ è½½æœ¬åœ°éŸ³é¢‘æ–‡ä»¶åªéœ€ä¿®æ”¹èµ„æºçš„åç¼€ä¸ºéŸ³é¢‘å¯¹åº”çš„åç¼€åï¼Œå¦‚MP3ã€‚</p>
<p><code>let filePath = NSBundle.mainBundle().pathForResource(&quot;èµµä¼  - æ¯æ¬¡éƒ½æƒ³å‘¼å–Šä½ çš„åå­—&quot;, ofType: &quot;mp3&quot;)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">import UIKit</div><div class="line">import AVKit</div><div class="line">import AVFoundation</div><div class="line"></div><div class="line">lazy var playerController: AVPlayerViewController = &#123;</div><div class="line">        let filePath = NSBundle.mainBundle().pathForResource(&quot;éŸ³ä¹å–·æ³‰&quot;, ofType: &quot;mp4&quot;)</div><div class="line">        let sourceMovieURL = NSURL(fileURLWithPath: filePath!)</div><div class="line">        let movieAsset = AVURLAsset(URL: sourceMovieURL)</div><div class="line">        let playItem = AVPlayerItem(asset: movieAsset)</div><div class="line">        let player = AVPlayer(playerItem: playItem)</div><div class="line">        let playerController = AVPlayerViewController()</div><div class="line">        playerController.player = player</div><div class="line">        playerController.view.frame = self.view.frame</div><div class="line">        self.addChildViewController(playerController)</div><div class="line">        playerController.videoGravity = AVLayerVideoGravityResizeAspectFill</div><div class="line">        return playerController</div><div class="line">    &#125;()</div><div class="line">    </div><div class="line">override func viewDidLoad() &#123;</div><div class="line">        super.viewDidLoad()</div><div class="line">        self.view.addSubview(playerController.view)</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>AVFoundationæ”¯æŒä¸‰ç§è§†é¢‘å¡«å……æ¨¡å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">AVLayerVideoGravityResizeAspect		ä¿ç•™é•¿å®½æ¯”ï¼Œæœªå¡«å……éƒ¨åˆ†ä¼šæœ‰é»‘è¾¹</div><div class="line">AVLayerVideoGravityResizeAspectFill	ä¿ç•™é•¿å®½æ¯”ï¼Œå¡«å……æ‰€æœ‰çš„åŒºåŸŸ</div><div class="line">AVLayerVideoGravityResize		æ‹‰ä¼¸å¡«æ»¡æ‰€æœ‰çš„ç©ºé—´</div></pre></td></tr></table></figure>
<h3 id="åŠ è½½ç½‘ç»œè§†é¢‘"><a href="#åŠ è½½ç½‘ç»œè§†é¢‘" class="headerlink" title="åŠ è½½ç½‘ç»œè§†é¢‘"></a>åŠ è½½ç½‘ç»œè§†é¢‘</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">lazy var playerController: AVPlayerViewController = &#123;</div><div class="line">        let player = AVPlayer(URL: NSURL(string:</div><div class="line">            &quot;http://www.ebookfrenzy.com/ios_book/movie/movie.mov&quot;)!)</div><div class="line">        let playerController = AVPlayerViewController()</div><div class="line">        playerController.player = player</div><div class="line">        playerController.view.frame = self.view.frame</div><div class="line">        self.addChildViewController(playerController)</div><div class="line">        playerController.videoGravity = AVLayerVideoGravityResizeAspectFill</div><div class="line">        return playerController</div><div class="line">    &#125;()</div></pre></td></tr></table></figure>
<h2 id="äºŒã€AVAudioPlayer"><a href="#äºŒã€AVAudioPlayer" class="headerlink" title="äºŒã€AVAudioPlayer"></a>äºŒã€AVAudioPlayer</h2><p>AVAudioPlayerå°è£…äº†æ’­æ”¾å•ä¸ªéŸ³é¢‘çš„èƒ½åŠ›ã€‚å¯ä»¥é€šè¿‡NSURLæˆ–NSDataæ¥åˆå§‹åŒ–ï¼ŒAVAudioPlayerä¸å…·å¤‡æµåª’ä½“æ’­æ”¾èƒ½åŠ›ï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè¯·æ±‚åè·å–çš„NSDataé—´æ¥å®ç°æ’­æ”¾ç½‘ç»œèµ„æºã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦å¯¼å…¥AVFoundationæ¡†æ¶ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<h3 id="åŠ è½½æœ¬åœ°éŸ³é¢‘"><a href="#åŠ è½½æœ¬åœ°éŸ³é¢‘" class="headerlink" title="åŠ è½½æœ¬åœ°éŸ³é¢‘"></a>åŠ è½½æœ¬åœ°éŸ³é¢‘</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">import UIKit</div><div class="line">import AVFoundation</div><div class="line"></div><div class="line">class AudioPlayerViewController: UIViewController &#123;</div><div class="line"></div><div class="line">    lazy var audioPlayer: AVAudioPlayer? = &#123;</div><div class="line">        let filePath = NSBundle.mainBundle().pathForResource(&quot;èµµä¼  - æ¯æ¬¡éƒ½æƒ³å‘¼å–Šä½ çš„åå­—&quot;, ofType: &quot;mp3&quot;)</div><div class="line">        let sourceAudioURL = NSURL(fileURLWithPath: filePath!)</div><div class="line">        let audioPlayer: AVAudioPlayer!</div><div class="line">        do &#123;</div><div class="line">            audioPlayer = try AVAudioPlayer(contentsOfURL: sourceAudioURL)</div><div class="line">            audioPlayer.delegate = self</div><div class="line">            return audioPlayer</div><div class="line">        &#125; catch &#123;</div><div class="line">            // TODO:couldn&apos;t load file :(</div><div class="line">        &#125;</div><div class="line">        return nil</div><div class="line">    &#125;()</div><div class="line">    </div><div class="line">    override func viewDidLoad() &#123;</div><div class="line">        super.viewDidLoad()</div><div class="line">        audioPlayer?.play()</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">extension AudioPlayerViewController: AVAudioPlayerDelegate &#123;</div><div class="line">    // éŸ³é¢‘æ’­æ”¾å®Œæ¯•æ—¶</div><div class="line">    func audioPlayerDidFinishPlaying(player: AVAudioPlayer, successfully flag: Bool) &#123;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // è§£ç é”™è¯¯</div><div class="line">    func audioPlayerDecodeErrorDidOccur(player: AVAudioPlayer, error: NSError?) &#123;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // å½“éŸ³é¢‘æ’­æ”¾è¿‡ç¨‹ä¸­è¢«ä¸­æ–­æ—¶</div><div class="line">    func audioPlayerBeginInterruption(player: AVAudioPlayer) &#123;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // å½“ä¸­æ–­ç»“æŸæ—¶</div><div class="line">    func audioPlayerEndInterruption(player: AVAudioPlayer, withOptions flags: Int) &#123;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="åŠ è½½ç½‘ç»œéŸ³é¢‘"><a href="#åŠ è½½ç½‘ç»œéŸ³é¢‘" class="headerlink" title="åŠ è½½ç½‘ç»œéŸ³é¢‘"></a>åŠ è½½ç½‘ç»œéŸ³é¢‘</h3><blockquote>
<ol>
<li>åŠ è½½ç½‘ç»œéŸ³é¢‘æ–‡ä»¶ï¼Œæˆ‘ä»¬çš„ç­–ç•¥æ˜¯é€šè¿‡ç½‘ç»œè¯·æ±‚è·å–éŸ³é¢‘æµçš„NSDataæ•°æ®ï¼Œç„¶åä½¿ç”¨AVPlayerçš„åˆå§‹åŒ–æ–¹æ³•   è·å–playerå®ä¾‹ï¼Œè¿›è¡Œæ’­æ”¾;</li>
<li>å¯¹äºiOS7ä»¥ä¸Šçš„ç³»ç»Ÿï¼ˆå«iOS7ï¼‰,åœ¨ç¡®å®šæ–‡ä»¶æ ¼å¼çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨-initWithData:fileTypeHint:error:å’Œ-initWithContentsOfURL:fileTypeHint:error:ç”Ÿæˆå®ä¾‹ï¼Œæˆ–è€…æŠŠNSDataä¿å­˜ä¸ºå¯¹åº”åç¼€åçš„æ–‡ä»¶åä½¿ç”¨-initWithContentsOfURL:error:åå†ç”Ÿæˆå®ä¾‹;</li>
<li>å¯¹äºiOS7ä»¥ä¸‹çš„ç³»ç»Ÿï¼Œåœ¨ç¡®å®šæ–‡ä»¶æ ¼å¼çš„æƒ…å†µä¸‹ï¼Œæœ€ä¸ºå®‰å…¨çš„æ–¹æ³•æ˜¯æŠŠNSDataä¿å­˜ä¸ºå¯¹åº”åç¼€åçš„æ–‡ä»¶åä½¿ç”¨-initWithContentsOfURL:error:ç”Ÿæˆå®ä¾‹ã€‚</li>
</ol>
</blockquote>
<h4 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h4><p>å…³äºåŠ è½½ç½‘ç»œéŸ³é¢‘çš„æ›´å¤šæ³¨æ„äº‹é¡¹ï¼Œå¯ä»¥å‚è§â€œç å†œäººç”Ÿâ€çš„æŠ€æœ¯åšå®¢:<br><a href="http://msching.github.io/blog/2014/05/04/secret-of-avaudioplayer/" target="_blank" rel="external">AVAudioPlayerçš„1937337955é”™è¯¯ç ”ç©¶</a></p>
<h2 id="ä¸‰ã€AVPlayer"><a href="#ä¸‰ã€AVPlayer" class="headerlink" title="ä¸‰ã€AVPlayer"></a>ä¸‰ã€AVPlayer</h2><p><code>AVPlayer</code>æ”¯æŒæœ¬åœ°å’Œç½‘ç»œæµåª’ä½“æ’­æ”¾ï¼ŒAVPlayerViewControllerå®é™…ä¸Šæ˜¯AVPlayerçš„å°è£…ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è‡ªå®šä¹‰ä¸€æ¬¾æµåª’ä½“è§†é¢‘æˆ–éŸ³é¢‘æ’­æ”¾å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„ä½¿ç”¨AVPlayerå®ç°ã€‚AVPlayerçš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<h3 id="åˆå§‹åŒ–AVPlayer"><a href="#åˆå§‹åŒ–AVPlayer" class="headerlink" title="åˆå§‹åŒ–AVPlayer"></a>åˆå§‹åŒ–AVPlayer</h3><p>æ­¤å¤„çš„urlå¯ä»¥ä¸Šæœ¬åœ°åª’ä½“èµ„æºurlä¹Ÿå¯ä»¥æ˜¯ç½‘ç»œèµ„æºurl</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">let playerItem = AVPlayerItem(URL: NSURL(string: &quot;url&quot;)!)</div><div class="line">let player = AVPlayer(playerItem: playerItem)</div></pre></td></tr></table></figure>
<h3 id="æ·»åŠ å±æ€§ç›‘å¬"><a href="#æ·»åŠ å±æ€§ç›‘å¬" class="headerlink" title="æ·»åŠ å±æ€§ç›‘å¬"></a>æ·»åŠ å±æ€§ç›‘å¬</h3><p>æ­¤å¤„åˆ©ç”¨KVOç›‘å¬playerçš„currentItemçš„statuså’ŒloadTimeRangesä¸¤ä¸ªå±æ€§ã€‚statusæ˜¯è¡¨ç¤ºplayerçŠ¶æ€çš„ä¸€ä¸ªæšä¸¾ï¼Œåªæœ‰å½“statusçŠ¶æ€ä¸ºReadyToPlayæ—¶ï¼Œæˆ‘ä»¬æ‰èƒ½å¯¹èµ„æºè¿›è¡Œæ’­æ”¾ï¼Œå¹¶è·å–éŸ³é¢‘æ—¶é•¿ç­‰ä¿¡æ¯ã€‚é€šè¿‡å¯¹loadTimeRangeså±æ€§çš„å®æ—¶ç›‘å¬ï¼Œè·å–èµ„æºçš„ç¼“å†²è¿›åº¦ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public enum AVPlayerStatus : Int &#123;</div><div class="line">    </div><div class="line">    case Unknown</div><div class="line">    case ReadyToPlay</div><div class="line">    case Failed</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">// æ·»åŠ ç›‘å¬</div><div class="line">func addObserverForPlayItem() &#123;</div><div class="line">    player.currentItem?.addObserver(self, forKeyPath: &quot;status&quot;, options: NSKeyValueObservingOptions.New, context: nil)</div><div class="line">    player.currentItem?.addObserver(self, forKeyPath: &quot;loadedTimeRanges&quot;, options: NSKeyValueObservingOptions.New, context: nil)</div><div class="line">&#125;</div><div class="line"></div><div class="line">// ç§»é™¤ç›‘å¬</div><div class="line">func removeObserverForPlayItem() &#123;</div><div class="line">    player.currentItem?.removeObserver(self, forKeyPath: &quot;status&quot;)</div><div class="line">    player.currentItem?.removeObserver(self, forKeyPath: &quot;loadedTimeRanges&quot;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">override func observeValueForKeyPath(keyPath: String?, ofObject object: AnyObject?, change: [String : AnyObject]?, context: UnsafeMutablePointer&lt;Void&gt;) &#123;</div><div class="line">    if keyPath == &quot;status&quot; &#123;</div><div class="line">        let status = change![&quot;new&quot;] as! Int</div><div class="line">        if status == AVPlayerStatus.ReadyToPlay.rawValue &#123;</div><div class="line">            // ä¾‹å¦‚è·å–éŸ³é¢‘æ—¶é•¿ï¼Œåˆ·æ–°UIç•Œé¢</div><div class="line">        &#125;</div><div class="line">    &#125; else if keyPath == &quot;loadedTimeRanges&quot; &#123;</div><div class="line">        let array = player.currentItem?.loadedTimeRanges</div><div class="line">        let timeRanges = array?.first?.CMTimeRangeValue</div><div class="line">        let startSeconds = CMTimeGetSeconds(timeRanges!.start)</div><div class="line">        let durationSeconds = CMTimeGetSeconds(timeRanges!.duration)</div><div class="line">        let bufferTime = startSeconds + durationSeconds</div><div class="line">        // è·å–bufferTimeåˆ·æ–°ç•Œé¢ç¼“å†²è¿›åº¦æ¡</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="å…¶ä»–ç›¸å…³å±æ€§ã€æ–¹æ³•ä»‹ç»"><a href="#å…¶ä»–ç›¸å…³å±æ€§ã€æ–¹æ³•ä»‹ç»" class="headerlink" title="å…¶ä»–ç›¸å…³å±æ€§ã€æ–¹æ³•ä»‹ç»"></a>å…¶ä»–ç›¸å…³å±æ€§ã€æ–¹æ³•ä»‹ç»</h3><p>æ’­æ”¾ï¼š<code>player.play()</code></p>
<p>æš‚åœï¼š<code>player.pauseï¼ˆï¼‰</code></p>
<p>è·å–å½“å‰æ’­æ”¾æ—¶é—´ï¼štimeScaleæŒ‡çš„æ˜¯1ç§’éœ€è¦æœ‰å‡ ä¸ªå¸§æ„æˆï¼ˆfpsï¼‰ï¼Œæ‰€ä»¥è¦å¾—åˆ°ç§’æ•°ï¼Œéœ€è¦ç”¨å¦‚ä¸‹æ–¹å¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let currentTime = Double(player.currentTime().value) / Double(player.currentTime().timescale)</div></pre></td></tr></table></figure>
<p>è·å–æ€»æ—¶é•¿ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let duration = Double(player.currentItem!.duration.value) / Double(player.currentItem!.duration.timescale)</div></pre></td></tr></table></figure>
<p>æ‹–åŠ¨è¿›åº¦æ¡ï¼š<code>player.seekToTime(time: cmTime)</code></p>
<p>è¿™ä¸ªæ–¹æ³•å¯ä»¥æŒ‡å®šæ’­æ”¾åˆ°å“ªä¸€ä¸ªæ—¶åˆ»ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªCMTimeç±»å‹çš„æ•°æ®ï¼ŒCMTimeæ˜¯ä¸€ç§ç”¨äºè¡¨å¾åª’ä½“èµ„æºæ—¶é—´çš„ä¸“ç”¨ç±»ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡CMTimeæ„é€ æ–¹æ³•åˆ›å»ºCMTimeå®ä¾‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">timeScale = player.currentItem.duration.timeScale</div><div class="line">let cmTime = CMTime(seconds: seconds, preferredTimescale: timeScale)</div></pre></td></tr></table></figure>
<h4 id="å‹æƒ…é“¾æ¥"><a href="#å‹æƒ…é“¾æ¥" class="headerlink" title="å‹æƒ…é“¾æ¥"></a>å‹æƒ…é“¾æ¥</h4><p><a href="http://msching.github.io/blog/2014/07/07/audio-in-ios/" target="_blank" rel="external">ç å†œäººç”Ÿ iOSéŸ³é¢‘æ’­æ”¾ç³»åˆ—åšå®¢</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€ã€AVPlayerViewController&quot;&gt;&lt;a href=&quot;#ä¸€ã€AVPlayerViewController&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€AVPlayerViewController&quot;&gt;&lt;/a&gt;ä¸€ã€AVPlayerView
    
    </summary>
    
      <category term="iOS" scheme="http://wuqiuhao.github.io/categories/iOS/"/>
    
    
      <category term="AVPlayerViewController" scheme="http://wuqiuhao.github.io/tags/AVPlayerViewController/"/>
    
  </entry>
  
  <entry>
    <title>UILabelå‚ç›´æ–¹å‘å¸ƒå±€è°ƒæ•´â€”â€”å®ç°å±…ä¸Šå±…ä¸‹æ•ˆæœ</title>
    <link href="http://wuqiuhao.github.io/2016/03/30/UILabel%E5%9E%82%E7%9B%B4%E6%96%B9%E5%90%91%E5%B8%83%E5%B1%80%E8%B0%83%E6%95%B4%E2%80%94%E2%80%94%E5%AE%9E%E7%8E%B0%E5%B1%85%E4%B8%8A%E5%B1%85%E4%B8%8B%E6%95%88%E6%9E%9C/"/>
    <id>http://wuqiuhao.github.io/2016/03/30/UILabelå‚ç›´æ–¹å‘å¸ƒå±€è°ƒæ•´â€”â€”å®ç°å±…ä¸Šå±…ä¸‹æ•ˆæœ/</id>
    <published>2016-03-30T02:49:34.000Z</published>
    <updated>2016-04-16T07:55:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>iOS UIKitæ¡†æ¶é»˜è®¤åªèƒ½é€šè¿‡UILableçš„textAlignmentå±æ€§è°ƒæ•´å…¶æ°´å¹³æ–¹å‘ä¸Šçš„å¸ƒå±€ï¼Œè®¾ç½®æ–‡å­—æ°´å¹³å±…å·¦ã€å±…ä¸­å’Œå±…å³ã€‚ä¸èƒ½å¯¹æ–‡å­—å‚ç›´æ–¹å‘ä¸Šçš„å¸ƒå±€åšå‡ºç›´æ¥è°ƒæ•´ï¼Œä½†æ˜¯æˆ‘ä»¬é€šè¿‡é‡å†™UILabelçš„textRectForBoundså’ŒdrawTextInRectæ–¹æ³•ï¼Œèƒ½å¤Ÿå¾ˆä¾¿æ·çš„è°ƒæ•´UILableçš„å†…å®¹å¸ƒå±€ï¼Œå®ç°å±…ä¸Šã€å‚ç›´å±…ä¸­å’Œå±…ä¸‹çš„æ•ˆæœã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<h3 id="åˆ›å»ºVerticalAlignmentæšä¸¾"><a href="#åˆ›å»ºVerticalAlignmentæšä¸¾" class="headerlink" title="åˆ›å»ºVerticalAlignmentæšä¸¾"></a>åˆ›å»ºVerticalAlignmentæšä¸¾</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">enum VerticalAlignment &#123;</div><div class="line">	case Top</div><div class="line">	case Middle</div><div class="line">	case Bottom</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="é‡å†™UILabel"><a href="#é‡å†™UILabel" class="headerlink" title="é‡å†™UILabel"></a>é‡å†™UILabel</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">class HLable: UILabel &#123;</div><div class="line">    </div><div class="line">    override init(frame: CGRect) &#123;</div><div class="line">        self.verticalAlignment = .Middle</div><div class="line">        super.init(frame: frame)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    required init?(coder aDecoder: NSCoder) &#123;</div><div class="line">        self.verticalAlignment = .Middle</div><div class="line">        super.init(coder: aDecoder)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    var verticalAlignment: VerticalAlignment &#123;</div><div class="line">        didSet &#123;</div><div class="line">            self.setNeedsDisplay()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    override func textRectForBounds(bounds: CGRect, limitedToNumberOfLines numberOfLines: Int) -&gt; CGRect &#123;</div><div class="line">        var textRect = super.textRectForBounds(bounds, limitedToNumberOfLines: numberOfLines)</div><div class="line">        switch self.verticalAlignment &#123;</div><div class="line">        case .Top:</div><div class="line">            textRect.origin.y = bounds.origin.y</div><div class="line">        case .Bottom:</div><div class="line">            textRect.origin.y = bounds.origin.y + bounds.size.height - textRect.size.height</div><div class="line">        case .Middle:</div><div class="line">            textRect.origin.y = bounds.origin.y + (bounds.size.height - textRect.size.height) / 2.0</div><div class="line">        &#125;</div><div class="line">        return textRect</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    override func drawTextInRect(rect: CGRect) &#123;</div><div class="line">        let actualRect = self.textRectForBounds(rect, limitedToNumberOfLines: numberOfLines)</div><div class="line">        super.drawTextInRect(actualRect)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">let label = HLabel()</div><div class="line">label.verticalAlignment = .Top</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;iOS UIKitæ¡†æ¶é»˜è®¤åªèƒ½é€šè¿‡UILableçš„textAlignmentå±æ€§è°ƒæ•´å…¶æ°´å¹³æ–¹å‘ä¸Šçš„å¸ƒå±€ï¼Œè®¾ç½®æ–‡å­—æ°´å¹³å±…å·¦ã€å±…ä¸­å’Œå±…å³ã€‚ä¸èƒ½å¯¹æ–‡å­—å‚ç›´æ–¹å‘ä¸Šçš„å¸ƒå±€åšå‡ºç›´æ¥è°ƒæ•´ï¼Œä½†æ˜¯æˆ‘ä»¬é€šè¿‡é‡å†™UILabelçš„textRectForBoundså’ŒdrawTextInRectæ–¹æ³•
    
    </summary>
    
      <category term="iOS" scheme="http://wuqiuhao.github.io/categories/iOS/"/>
    
    
      <category term="UILabel" scheme="http://wuqiuhao.github.io/tags/UILabel/"/>
    
  </entry>
  
</feed>
